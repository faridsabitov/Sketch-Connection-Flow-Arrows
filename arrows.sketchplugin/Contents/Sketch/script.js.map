{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./src/script.js","webpack://exports/external \"sketch\"","webpack://exports/external \"sketch/dom\"","webpack://exports/external \"sketch/settings\"","webpack://exports/external \"sketch/ui\""],"names":["UI","require","pluginKey","document","sketch","fromNative","context","docData","documentData","pluginData","command","valueForKey_onLayer_forPluginIdentifier","currentParentGroup","currentPage","currentArtboard","newConnectionsData","getConnectionsData","Settings","createAutoArrow","start","createRightArrow","createDownArrow","createLeftArrow","createUpArrow","createRightArrowWithCondition","createDownArrowWithCondition","createLeftArrowWithCondition","createUpArrowWithCondition","updateSelectedArrows","selection","count","currentConnectionsData","g","objectID","connectionIndex","findConnectionData","updateArrow","firstObject","secondObject","style","type","direction","line","condition","message","setValue_forKey_onLayer_forPluginIdentifier","updateArtboardArrows","connections","firstObjectArtboard","secondObjectArtboard","length","updateArrowsCounter","i","getLayerWithID","sketchObject","parentArtboard","class","push","updateAllArrows","deleteAllArrows","deleteLine","deleteArtboardArrows","deleteConnectionFromData","deleteSelectedArrows","settings","alert","COSAlertWindow","new","viewWidth","viewHeight","alertSetup","view","NSView","alloc","initWithFrame","NSMakeRect","addAccessoryView","arrowStyleLabel","alertLabel","addSubview","arrowStylingField","NSPopUpButton","setActiveStyleSetting","arrowStyleInfoLabel","arrowTypeLabel","arrowTypeField","setActiveTypeSetting","arrowTypeInfoLabel","arrowSpacingLabel","arrowSpacingPxLabel","arrowSpacingField","NSTextField","formatter","NSNumberFormatter","init","autorelease","setStringValue","String","settingForKey","setFormatter","arrowSpacingStepper","NSStepper","setMaxValue","setMinValue","setValueWraps","setAutorepeat","setCOSJSTargetFunction","sender","value","integerValue","arrowSpacingInfoLabel","otherSettingsLabel","checkbox","alertCheckbox","autoAlignInfoLabel","pluginInfoLabel","modalResponse","runModal","NSAlertFirstButtonReturn","views","subviews","title","setSettingForKey","intValue","state","onLayersMoved","action","actionContext","panel","ControlBar","NSPanel","setStyleMask","NSTitledWindowMask","NSFullSizeContentViewWindowMask","setTitleVisibility","NSWindowTitleHidden","setTitlebarAppearsTransparent","setFrame_display","setMovableByWindowBackground","setHasShadow","setLevel","NSFloatingWindowLevel","center","makeKeyAndOrderFront","nil","firstObjectID","secondObjectID","lineID","conditionID","isCondition","conditionObject","remove","createArrow","localDirection","getDirection","updateSpacing","autoAlignLayer","arrow","drawConnection","connection","checkForGroup","groupName","currentGroup","layers","name","firstObjectMidX","frame","x","width","firstObjectMidY","y","height","secondObjectMidX","secondObjectMidY","diffX","diffY","absDiffX","Math","abs","absDiffY","localType","connectionPos","getConnectionPos","drawAngledLine","firstLayerPosX","firstLayerPosY","middlePosX","middlePosY","secondLayerPosX","secondLayerPosY","drawStraightLine","drawCurvedLine","addCondition","styleLine","addToArrowsGroup","addLayers","fixGeometryWithOptions","Group","group","parent","locked","moveToBack","adjustToFit","addToConditionGroup","conGroup","arGroup","arGroupX","arGroupY","dataArray","data","arrayNumber","docSettings","styles","getLayerStyles","addItemWithTitle","docTypeSettings","lastItem","setState","newConnections","lineObject","selectedGroup","sourceObjectID","childObjectID","sourceObject","childObject","currentSpacing","sourceMidY","childMidY","sourceMidX","childMidX","diff","defineSourceObject","id","getSourceObjectFromSelection","setMessageText","addButtonWithTitle","infoLabel","setSelectable","setDrawsBackground","setBezeled","textColor","NSColor","disabledControlTextColor","NSButton","setButtonType","NSSwitchButton","setBezelStyle","setTitle","currentState","allStyles","allLayerStyles","keyword","includes","libraries","getLibraries","libraryObject","symbolReferences","symbol","getImportableSymbolReferencesForDocument","symbolMaster","import","createNewInstance","firstObjectAbsPos","changeBasis","from","to","secondObjectAbsPos","path","NSBezierPath","bezierPath","moveToPoint","NSMakePoint","lineToPoint","MSShapeGroup","layerWithPath","MSPath","pathWithBezierPath","setName","points","cornerRadius","curveMode","hasCurveFrom","hasCurveTo","curveFrom","curveTo","localStyle","ownStyle","sharedStyle","border","addStylePartOfType","color","MSColor","colorWithRGBADictionary","r","b","a","thickness","endMarkerType"],"mappings":"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","file":"script.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/script.js\");\n","import sketch from 'sketch'\n// const { toArray } = require('util')\n\n//\n//  Variables\n//\n\nlet UI = require('sketch/ui') \n// var SharedStyle = require('sketch/dom').SharedStyle\n\nconst pluginKey = \"flowArrows\"\nconst document = sketch.fromNative(context.document)\nlet docData = context.document.documentData()\nlet pluginData = context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowConnections\", docData, pluginKey)\nlet currentParentGroup = docData.currentPage().currentArtboard() || docData.currentPage() // TODO: Might be a problem for multiple artboards\nlet newConnectionsData = getConnectionsData()\n\n// Settings\nvar Settings = require('sketch/settings')\n\n  \n//\n//  Create Connection Function\n//\n\nexport default function(context) {}\nexport function createAutoArrow(context){start(context, \"Auto\", false)}\nexport function createRightArrow(context){start(context, \"Right\", false)}\nexport function createDownArrow(context){start(context, \"Down\", false)}\nexport function createLeftArrow(context){start(context, \"Left\", false)}\nexport function createUpArrow(context){start(context, \"Up\", false)}\n\nexport function createRightArrowWithCondition(context){start(context, \"Right\", true)}\nexport function createDownArrowWithCondition(context){start(context, \"Down\", true)}\nexport function createLeftArrowWithCondition(context){start(context, \"Left\", true)}\nexport function createUpArrowWithCondition(context){start(context, \"Up\", true)}\n\n//\n// Plugin Commands\n//\n\nexport function updateSelectedArrows(context) {\n\n  let selection = context.selection\n\n  if(selection.count() > 1){\n    // Need to find source object by ID first\n    // let sourceObjectID = getSourceObjectFromSelection(selection)\n    let currentConnectionsData = newConnectionsData\n\n    for(let g = 0; g < selection.count(); g++) {\n      if(selection[g].objectID() != selection[0].objectID()){\n        // Then need to create or update connection arrow with each selection\n        let connectionIndex = findConnectionData(selection[0].objectID(), selection[g].objectID(), currentConnectionsData)\n\n        if(connectionIndex != null){\n          updateArrow(currentConnectionsData[connectionIndex].firstObject, currentConnectionsData[connectionIndex].secondObject, currentConnectionsData[connectionIndex].style, currentConnectionsData[connectionIndex].type, currentConnectionsData[connectionIndex].direction, currentConnectionsData[connectionIndex].line, currentConnectionsData[connectionIndex].condition, connectionIndex)\n          sketch.UI.message(\"Current connection is updated \")\n        } else {\n          sketch.UI.message(\"There is no connection between selected layers on the plugin data\")\n        }\n      }\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n  } else {\n    // When user didn't select anything\n    sketch.UI.message(\"Please select more than two layers\")\n  }\n}\n\nexport function updateArtboardArrows(context) {\n  // TODO: Need to show amount of updated arrows and deleted ones\n  let selection = context.selection\n  let connections = getConnectionsData()\n  let firstObjectArtboard\n  let secondObjectArtboard\n  \n  if(connections.length > 0){\n    // We have connections in database\n    const updateArrowsCounter = connections.length\n    for (let i = 0; i < updateArrowsCounter; i ++) {\n      // Need to check if the element is selected globally or from the artboard\n      firstObjectArtboard = document.getLayerWithID(connections[i].firstObject)\n      firstObjectArtboard = firstObjectArtboard.sketchObject.parentArtboard().objectID()\n\n      secondObjectArtboard = document.getLayerWithID(connections[i].secondObject)\n      secondObjectArtboard = secondObjectArtboard.sketchObject.parentArtboard().objectID()\n\n      if(selection.count() == 1 && selection[0].class() == \"MSArtboardGroup\"){\n        // Need to go through each connection and update arrow position for specific artboard\n        \n        if (firstObjectArtboard == selection[0].objectID()){\n          if (secondObjectArtboard == selection[0].objectID()){\n            updateArrow(connections[i].firstObject, connections[i].secondObject, connections[i].style, connections[i].type, connections[i].direction, connections[i].line, connections[i].condition, i)\n          } else {newConnectionsData.push(connections[i])}\n        } else {\n          // If not just saving it\n          newConnectionsData.push(connections[i])\n        }\n      }\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n    sketch.UI.message(\"All arrows are updated \")\n  } else {\n    // We don't have any connections to update\n    sketch.UI.message(\"There is nothing to update\")\n  }\n}\n\nexport function updateAllArrows(context) { // TODO\n  // TODO: Need to show amount of updated arrows and deleted ones\n  let currentConnectionsData = newConnectionsData\n  if(currentConnectionsData.length > 0){\n    // We have connections in database\n    const updateArrowsCounter = currentConnectionsData.length\n    for (let i = 0; i < updateArrowsCounter; i ++) {\n      // Need to go through each connection and update arrow position without artboards\n      // Need to check if current object don't have the parrent\n      updateArrow(currentConnectionsData[i].firstObject, currentConnectionsData[i].secondObject, currentConnectionsData[i].style, currentConnectionsData[i].type, currentConnectionsData[i].direction, currentConnectionsData[i].line, currentConnectionsData[i].condition, i)\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n    sketch.UI.message(\"All arrows are updated \")\n  } else {\n    // We don't have any connections to update\n    sketch.UI.message(\"There is nothing to update\")\n  }\n}\n\nexport function deleteAllArrows(context) {\n\n  if(newConnectionsData.length > 0){\n    // We have connections in database\n    for (let i = 0; i < newConnectionsData.length; i ++) {\n      // Need to go through each connection and update arrow position\n      deleteLine(newConnectionsData[i].line)\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(null, \"arrowConnections\", docData, pluginKey)\n    sketch.UI.message(\"All arrows are deleted\")\n  } else {\n    // We don't have any connections to update\n    sketch.UI.message(\"There is nothing to delete\")\n  }\n}\n\nexport function deleteArtboardArrows(context) {\n  let selection = context.selection\n  let firstObject, secondObject\n\n  // Need to delete all the arrows only from selected artboard\n  if(selection.count() == 1 && selection[0].class() == \"MSArtboardGroup\"){\n    let connections = getConnectionsData()\n    \n    if(connections.length > 0){\n      // We have connections in database\n      const updateArrowsCounter = connections.length\n      for (let i = 0; i < updateArrowsCounter; i ++) {\n        // Need to go through each connection and check if it placed on selected artboard\n        firstObject = document.getLayerWithID(connections[i].firstObject)\n        secondObject = document.getLayerWithID(connections[i].secondObject)\n        if (firstObject.sketchObject.parentArtboard().objectID() == selection[0].objectID()){\n          if (secondObject.sketchObject.parentArtboard().objectID() == selection[0].objectID()){\n            deleteLine(connections[i].line)\n            newConnectionsData = deleteConnectionFromData(i)\n          }\n        }\n      }\n      context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n      sketch.UI.message(\"All arrows from selected artboard are deleted\")\n    } else {\n      // We don't have any connections to update\n      sketch.UI.message(\"There is nothing to delete\")\n    }\n  } else {\n    sketch.UI.message(\"Please select one artboard\")\n  }\n}\n\nexport function deleteSelectedArrows(context) {\n  let selection = context.selection\n  let firstObject, secondObject\n\n  // Need to delete all the arrows only from selected artboard\n  if(selection.count() == 2){\n\n    for(let g = 0; g < selection.count(); g++) {\n\n      if(selection[g].objectID() != selection[0].objectID()){ // It will never check 3rd connection\n        let connections = getConnectionsData()\n        \n        let connectionIndex = findConnectionData(selection[0].objectID(), selection[g].objectID(), connections)\n        \n        if(connectionIndex != null){\n          // We have connections in database\n          deleteLine(connections[connectionIndex].line)\n          newConnectionsData = deleteConnectionFromData(connectionIndex)\n          const updateArrowsCounter = connections.length\n          for (let i = 0; i < updateArrowsCounter; i ++) {\n            // Need to go through each connection and check if it placed on selected artboard\n            firstObject = document.getLayerWithID(connections[i].firstObject)\n            secondObject = document.getLayerWithID(connections[i].secondObject)\n            if(firstObject.sketchObject.parentArtboard().objectID() == selection[0].objectID()){\n              if(secondObject.sketchObject.parentArtboard().objectID() == selection[0].objectID()){\n                deleteLine(connections[i].line)\n                newConnectionsData = deleteConnectionFromData(i)\n              }\n            }\n          }\n          context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n          sketch.UI.message(\"All arrows from selected layers are deleted \")\n        }\n      }\n    }\n  } else {\n    sketch.UI.message(\"Select two layers, please \")\n  }\n}\n\nexport function settings(context) {\n  let alert = COSAlertWindow.new()\n  const viewWidth = 300\n  const viewHeight = 450\n  \n  // Alert window settings\n  alert = alertSetup(alert, viewWidth, viewHeight)\n  let view = NSView.alloc().initWithFrame(NSMakeRect(0, 0, viewWidth, viewHeight))\n  alert.addAccessoryView(view)\n\n  // Label: Arrow Style\n  let arrowStyleLabel = alertLabel(\"Arrow Style\", true, -1, viewHeight-40, 280, 40)\n  view.addSubview(arrowStyleLabel)\n\n  // Select: Arrow Style\n  let arrowStylingField = NSPopUpButton.alloc().initWithFrame(NSMakeRect(-2, viewHeight - 40, 300, 20));\n  setActiveStyleSetting(arrowStylingField)\n  view.addSubview(arrowStylingField)\n\n  // Label: Arrow Style Info\n  let arrowStyleInfoLabel = alertLabel(\"Add layer style to your document that will contain $arrow name and you will be able to specify it here \", false, -1, viewHeight-80, 300, 40)\n  view.addSubview(arrowStyleInfoLabel)\n\n\n  // Label: Arrow Type\n  let arrowTypeLabel = alertLabel(\"Arrow Type\", true, -1, viewHeight-130, 280, 40)\n  view.addSubview(arrowTypeLabel)\n\n  // Select: Arrow Type\n  let arrowTypeField = NSPopUpButton.alloc().initWithFrame(NSMakeRect(-2, viewHeight - 130, 300, 20));\n  setActiveTypeSetting(arrowTypeField)\n  view.addSubview(arrowTypeField)\n\n  // Label: Arrow Type Info\n  let arrowTypeInfoLabel = alertLabel(\"Select one of the arrow types. Angled is used by default\", false, -1, viewHeight-170, 300, 40)\n  view.addSubview(arrowTypeInfoLabel)\n\n\n  // Label: Arrow Spacing\n  let arrowSpacingLabel = alertLabel(\"Arrow Spacing\", true, -1, viewHeight - 200, 330, 20)\n  view.addSubview(arrowSpacingLabel)\n\n  // Label: Arrow Spacing PX\n  let arrowSpacingPxLabel = alertLabel(\"px\", true, 90, viewHeight - 220, 330, 20)\n  view.addSubview(arrowSpacingPxLabel)\n\n  // Input: Arrow Spacing\n  let arrowSpacingField = NSTextField.alloc().initWithFrame(NSMakeRect(-2, viewHeight - 220, 80, 20))\n  var formatter = NSNumberFormatter.alloc().init().autorelease()\n  arrowSpacingField.setStringValue(String(Settings.settingForKey(\"arrowSpacing\")))\n  arrowSpacingField.setFormatter(formatter)\n  view.addSubview(arrowSpacingField)\n\n  // Stepper: Arrow Spacing\n  let arrowSpacingStepper = NSStepper.alloc().initWithFrame(NSMakeRect(70, viewHeight - 220, 20, 20));\n  arrowSpacingStepper.setMaxValue(1000)\n  arrowSpacingStepper.setMinValue(0)\n  arrowSpacingStepper.setValueWraps(false)\n  arrowSpacingStepper.setAutorepeat(true)\n  arrowSpacingStepper.setCOSJSTargetFunction(function(sender){\n    var value = 0 + sender.integerValue()\n    arrowSpacingField.setStringValue(String(value))\n  })\n  \n  view.addSubview(arrowSpacingStepper)\n  // view.addSubview(formatter)\n  \n  // Label: Auto Spacing Info\n  let arrowSpacingInfoLabel = alertLabel(\"The second layer will be moved closer based on the value provided here. Keep it 0 if you don't want to have auto spacing feature \", false, -1, viewHeight-285, 300, 60)\n  view.addSubview(arrowSpacingInfoLabel)\n\n  // Label: Other Settings\n  let otherSettingsLabel = alertLabel(\"Other Settings\", true, -1, viewHeight-330, 280, 40)\n  view.addSubview(otherSettingsLabel)\n\n  // Checkbox: Auto-Align\n  let checkbox = alertCheckbox(\"Second layer auto-align\", false, -1, viewHeight-340, 260, 40)\n  view.addSubview(checkbox)\n\n  // Label: Auto-Align Info\n  let autoAlignInfoLabel = alertLabel(\"Align the second layer for 5px misalignment with the first one\", false, -1, viewHeight-370, 280, 40)\n  view.addSubview(autoAlignInfoLabel)\n\n  // Label: Plugin Info\n  let pluginInfoLabel = alertLabel(\"Made by @faridSabitov with the support of EPAM.com \", true, -1, viewHeight-420, 280, 40)\n  view.addSubview(pluginInfoLabel)\n\n\n  // Need to check if style is still available\n\n  // Show modal and get the results\n  let modalResponse = alert.runModal()\n\n  if(modalResponse == NSAlertFirstButtonReturn){\n    // When user clicks on \"Update Settings\"\n    // Need to save all this results into the Plugin Settings\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(alert.views()[0].subviews()[1].title(), \"arrowStyle\", docData, pluginKey)\n    Settings.setSettingForKey(\"arrowType\", alert.views()[0].subviews()[4].title())\n    Settings.setSettingForKey(\"arrowSpacing\", alert.views()[0].subviews()[8].intValue())\n    Settings.setSettingForKey(\"autoAlign\", alert.views()[0].subviews()[12].state())\n    UI.message(\"Settings are updated \")\n  }\n}\n\nexport function onLayersMoved(context) {\n  sketch.UI.message(\"Please select more than two layers\")\n  const action = context.actionContext  \n}\n\nexport function panel(context) {\n  let ControlBar\n  ControlBar = NSPanel.alloc().init();\n  ControlBar.setStyleMask(NSTitledWindowMask + NSFullSizeContentViewWindowMask);\n  // ControlBar.setBackgroundColor(NSColor.colorWithRed_green_blue_alpha(0.99, 0.99, 0.99, 1));\n  ControlBar.setTitleVisibility(NSWindowTitleHidden);\n  ControlBar.setTitlebarAppearsTransparent(true);\n  ControlBar.setFrame_display(NSMakeRect(0, 0, 720, 50), false);\n  ControlBar.setMovableByWindowBackground(true);\n  ControlBar.setHasShadow(true);\n  ControlBar.setLevel(NSFloatingWindowLevel);\n\n  // contentView.addSubview(closeButton)\n  ControlBar.center();\n  ControlBar.makeKeyAndOrderFront(nil);\n\n//   getImage = function(size, name){\n//     var isRetinaDisplay = (NSScreen.mainScreen().backingScaleFactor() > 1)? true: false;\n//         suffix = (isRetinaDisplay)? \"@2x\": \"\",\n//         imageURL = NSURL.fileURLWithPath(self.pluginResources + \"/icons/\" + name + suffix + \".png\"),\n//         image = NSImage.alloc().initWithContentsOfURL(imageURL);\n//     return image\n// },\n// addButton = function(rect, name, callAction){\n//     var button = NSButton.alloc().initWithFrame(rect),\n//         image = getImage(rect.size, name);\n\n//     button.setImage(image);\n//     button.setBordered(false);\n//     button.sizeToFit();\n//     button.setButtonType(NSMomentaryChangeButton);\n//     button.setCOSJSTargetFunction(callAction);\n//     button.setAction(\"callAction:\");\n//     return button;\n// },\n// addImage = function(rect, name){\n//     var view = NSImageView.alloc().initWithFrame(rect),\n//         image = getImage(rect.size, name);\n//     view.setImage(image);\n//     return view;\n// },\n\n// closeButton = addButton( NSMakeRect(20, 10, 30, 30), \"close-control\",\n//     function(sender){\n//         coscript.setShouldKeepAround(false);\n//         threadDictionary.removeObjectForKey(identifier);\n//         ControlBar.close();\n// }),\n\n\n\n}\n\n//\n// Functions\n//\n\nfunction updateArrow(firstObjectID, secondObjectID, style, type, direction, lineID, conditionID, isCondition, connectionIndex) { // Refactored\n  // Need to check if we have the layers with such IDs\n  let firstObject = document.getLayerWithID(firstObjectID)\n  let secondObject = document.getLayerWithID(secondObjectID)\n  let conditionObject = document.getLayerWithID(conditionID)\n  \n  // Need to delete data first, because we will have a new line\n  deleteLine(lineID)\n  if(conditionObject){conditionObject.remove()}\n\n  newConnectionsData = deleteConnectionFromData(connectionIndex)\n\n  if(firstObject && secondObject){\n    // If we have all the objects, we can recreate the line\n    createArrow(firstObjectID, secondObjectID, style, type, direction, isCondition)\n  } \n}\n\nfunction createArrow(firstObjectID, secondObjectID, style, type, direction, isCondition) {  // Refactored\n  let localDirection = direction == \"Auto\" ? getDirection(firstObjectID, secondObjectID) : direction\n\n  // Main Operations based on the settings\n  updateSpacing(firstObjectID, secondObjectID, localDirection)\n  autoAlignLayer(firstObjectID, secondObjectID, localDirection)\n\n  // Making an Arrow \n  let arrow = drawConnection(firstObjectID, secondObjectID, style, type, direction, isCondition)\n  \n  // Storage for current connection\n  let connection = {\n    firstObject : firstObjectID,\n    secondObject : secondObjectID,\n    style : arrow.style,\n    condition : arrow.conditionID,\n    type : arrow.type,\n    direction: localDirection,\n    line : arrow.line.objectID()\n  }\n\n  // Need to save this data to the global array\n  newConnectionsData.push(connection)\n}\n\nfunction checkForGroup(groupName) { // refactored\n  let currentGroup = null\n\n  // Checking all the groups that we have\n  for(let i = 0; i < currentParentGroup.layers().count(); i++){\n    if(currentParentGroup.layers()[i].name() == groupName) {\n      currentGroup = currentParentGroup.layers()[i]\n    } \n  }\n\n  return currentGroup\n}\n\nfunction getDirection(firstObjectID, secondObjectID){ // Refactored\n  // Get direction from the source object\n  const firstObject = document.getLayerWithID(firstObjectID)\n  const secondObject = document.getLayerWithID(secondObjectID)\n  const firstObjectMidX = firstObject.frame.x+firstObject.frame.width/2\n  const firstObjectMidY = firstObject.frame.y+firstObject.frame.height/2\n  const secondObjectMidX = secondObject.frame.x+secondObject.frame.width/2\n  const secondObjectMidY = secondObject.frame.y+secondObject.frame.height/2\n\n  const diffX = firstObjectMidX - secondObjectMidX\n  const diffY = firstObjectMidY - secondObjectMidY\n  const absDiffX = Math.abs(diffX) \n  const absDiffY = Math.abs(diffY)\n  let direction\n\n  if(secondObjectMidX > firstObjectMidX){\n    // Right Half\n    if(secondObjectMidY > firstObjectMidY){\n      // Bottom quarter\n      direction = diffX > diffY ? \"Down\" : \"Right\"\n    } else {\n      // Top quarter\n      direction = absDiffX > absDiffY ? \"Right\" : \"Up\"\n    }\n  } else {\n    // Left Half\n    if(secondObjectMidY > firstObjectMidY){\n      // Bottom quarter\n      direction = absDiffX > absDiffY ? \"Left\" : \"Down\"\n    } else {\n      // Top quarter\n      direction = diffX > diffY ? \"Left\" : \"Up\"\n    }\n  }\n\n  return direction\n}\n\nfunction drawConnection(firstObjectID, secondObjectID, style, type, localDirection, condition){ // Refactored\n  // Process of creating new connection  \n  let localType = type == null ? Settings.settingForKey(\"arrowType\") : type\n  let firstObject = document.getLayerWithID(firstObjectID)\n  let secondObject = document.getLayerWithID(secondObjectID)\n  let connectionPos = getConnectionPos(firstObject, secondObject, localDirection)\n  let connection = {\n    line: [], \n    conditionID: [],\n    type: [],\n    style: []\n  }\n  \n  // Type  \n  if(localType == \"Angled\" || localType == null){ connection.line = drawAngledLine(connectionPos.firstLayerPosX, connectionPos.firstLayerPosY, connectionPos.middlePosX, connectionPos.middlePosY, connectionPos.secondLayerPosX, connectionPos.secondLayerPosY, localDirection)}\n  if(localType == \"Straight\"){ connection.line = drawStraightLine(connectionPos.firstLayerPosX, connectionPos.firstLayerPosY, connectionPos.secondLayerPosX, connectionPos.secondLayerPosY, localDirection)}\n  if(localType == \"Curved\"){ connection.line = drawCurvedLine(connectionPos.firstLayerPosX, connectionPos.firstLayerPosY, connectionPos.secondLayerPosX, connectionPos.secondLayerPosY, localDirection)}\n\n  // Condition\n  connection.conditionID = condition != false ? connection.conditionID = addCondition(\"#con\", connectionPos.middlePosX, connectionPos.middlePosY) : connection.conditionID = null\n\n  // Style\n  connection.style = styleLine(connection.line, style)\n\n  // Add to group\n  addToArrowsGroup(connection.line)\n\n  return connection\n}\n\nfunction addToArrowsGroup(line){\n  let currentGroup = checkForGroup(\"Arrows\")\n  if(currentGroup){\n    currentGroup.addLayers([line])\n    currentGroup.fixGeometryWithOptions(1)\n  } else {\n    let Group = require('sketch/dom').Group\n    let group = new Group({\n      parent: currentParentGroup,\n      name: 'Arrows',\n      locked: true,\n      layers: [line]\n    })\n    group.moveToBack()\n    group.adjustToFit()\n    \n  }\n}\n\nfunction addToConditionGroup(condition, x, y){ // Refactored\n  let conGroup = checkForGroup(\"Conditions\") \n  let arGroup = checkForGroup(\"Arrows\") \n  let arGroupX = arGroup != null ? arGroup.frame().x() : 0\n  let arGroupY = arGroup != null ? arGroup.frame().y() : 0\n  if(conGroup){\n    condition.frame.x = x - condition.frame.width / 2 - (conGroup.frame().x() - arGroupX) \n    condition.frame.y = y - condition.frame.height / 2 - (conGroup.frame().y() - arGroupY) \n    condition.parent = conGroup\n    conGroup.fixGeometryWithOptions(1)\n  } else {\n    condition.frame.x = x - condition.frame.width / 2 \n    condition.frame.y = y - condition.frame.height / 2\n    let Group = require('sketch/dom').Group\n    let group = new Group({\n      parent: currentParentGroup,\n      name: 'Conditions',\n      layers: [condition]\n    })\n    group.moveToBack()\n    group.adjustToFit()\n  }\n}\n\nfunction getConnectionsData(){ //Refactored\n  let dataArray = []\n  \n  if(pluginData){\n    for (let i = 0; i < pluginData.length; i ++) {\n      dataArray.push(pluginData[i])\n    }\n  } \n  return dataArray\n}\n\nfunction findConnectionData(firstObjectID, secondObjectID, data){\n  let arrayNumber = null\n  firstObjectID = String(firstObjectID)\n  secondObjectID = String(secondObjectID)\n\n  if(pluginData){\n    // If we have database, need to check for connections\n\n    for(let y = 0; y < data.length; y++){\n\n      if(firstObjectID == data[y].firstObject || firstObjectID == data[y].secondObject){\n        // if we found that we have this object in connection database already\n        if(secondObjectID == data[y].firstObject || secondObjectID == data[y].secondObject){\n          // if we found that we have this object in connection database already\n          arrayNumber = y\n        } \n      }\n    }\n  }\n  return arrayNumber\n}\n\nfunction setActiveStyleSetting(arrowStylingField){\n  let docSettings = context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey)\n  let styles = getLayerStyles(null)\n\n  if(docSettings){\n    // We have info about the settings in the current document\n    \n    if(docSettings != \"Default Style\") {\n      // if user specified own option\n      arrowStylingField.addItemWithTitle(docSettings)\n      arrowStylingField.addItemWithTitle(\"Default Style\")\n      for(let i = 0; i < styles.length; i++){\n        if(styles[i].name() != docSettings){\n          arrowStylingField.addItemWithTitle(styles[i].name())\n        }\n      }\n\n    } else {\n      // Need to show the default first\n      arrowStylingField.addItemWithTitle(\"Default Style\")\n      for(let i = 0; i < styles.length; i++){\n        arrowStylingField.addItemWithTitle(styles[i].name())\n      }\n    }\n  } else {\n    arrowStylingField.addItemWithTitle(\"Default Style\")\n    for(let i = 0; i < styles.length; i++){\n      arrowStylingField.addItemWithTitle(styles[i].name())\n    }\n  }\n}\n\nfunction setActiveTypeSetting(arrowTypeField){\n  let docTypeSettings = Settings.settingForKey(\"arrowType\")  \n\n\n  if(docTypeSettings){\n    // We have info about the settings in the current document\n    \n    if(docTypeSettings == \"Angled\"){\n      arrowTypeField.addItemWithTitle(\"Angled\")\n      arrowTypeField.lastItem().setState(1)\n      arrowTypeField.addItemWithTitle(\"Curved\")\n      arrowTypeField.lastItem().setState(0)\n      arrowTypeField.addItemWithTitle(\"Straight\")\n      arrowTypeField.lastItem().setState(0)\n    } \n\n    if(docTypeSettings == \"Curved\"){\n      arrowTypeField.addItemWithTitle(\"Curved\")\n      arrowTypeField.lastItem().setState(1)\n      arrowTypeField.addItemWithTitle(\"Straight\")\n      arrowTypeField.lastItem().setState(0)\n      arrowTypeField.addItemWithTitle(\"Angled\")\n      arrowTypeField.lastItem().setState(0)\n    } \n\n    if(docTypeSettings == \"Straight\"){\n      arrowTypeField.addItemWithTitle(\"Straight\")\n      arrowTypeField.lastItem().setState(1)\n      arrowTypeField.addItemWithTitle(\"Angled\")\n      arrowTypeField.lastItem().setState(0)\n      arrowTypeField.addItemWithTitle(\"Curved\")\n      arrowTypeField.lastItem().setState(0)\n    } \n  } else {\n    // Show default\n    arrowTypeField.addItemWithTitle(\"Angled\")\n    arrowTypeField.addItemWithTitle(\"Curved\")\n    arrowTypeField.addItemWithTitle(\"Straight\")\n  }\n\n}\n\nfunction deleteConnectionFromData(connectionIndex){ // Refactored\n  let newConnections = []\n  if(pluginData){\n    // If we have database\n    let connections = pluginData\n\n    for (let i = 0; i < connections.length; i ++) {\n      // Updating all connections without deleted one\n      if(i != connectionIndex){\n        newConnections.push(connections[i])\n      }\n    }\n  }\n  return newConnections\n}\n\nfunction deleteLine(lineID){ // refactored\n  let lineObject = document.getLayerWithID(lineID)\n  let selectedGroup\n  if(lineObject){\n    selectedGroup = lineObject.parent\n    lineObject.remove()\n    if(selectedGroup.layers.length == 0){\n      selectedGroup.remove()\n    }\n  }\n}\n\nfunction updateSpacing(sourceObjectID, childObjectID, direction){\n  let sourceObject = document.getLayerWithID(sourceObjectID)\n  let childObject = document.getLayerWithID(childObjectID)\n\n  if(Settings.settingForKey(\"arrowSpacing\") && Settings.settingForKey(\"arrowSpacing\") != 0){\n    let currentSpacing = Settings.settingForKey(\"arrowSpacing\")\n    \n    if(direction == \"Right\"){\n      childObject.frame.x = sourceObject.frame.x + sourceObject.frame.width + currentSpacing\n    }\n  \n    if(direction == \"Down\"){\n      childObject.frame.y = sourceObject.frame.y + sourceObject.frame.height + currentSpacing\n    }\n  \n    if(direction == \"Left\"){\n      childObject.frame.x = sourceObject.frame.x - childObject.frame.width - currentSpacing\n    }\n  \n    if(direction == \"Up\"){\n      childObject.frame.y = sourceObject.frame.y - childObject.frame.height - currentSpacing\n    }\n  }\n}\n\nfunction autoAlignLayer(sourceObjectID, childObjectID, direction){\n  let sourceObject = document.getLayerWithID(sourceObjectID)\n  let childObject = document.getLayerWithID(childObjectID)\n  let sourceMidY, childMidY, sourceMidX, childMidX, diff\n\n  if(Settings.settingForKey(\"autoAlign\")){\n    if(Settings.settingForKey(\"autoAlign\") == true){\n      // If user turned on Auto-Align settings\n      \n      if(direction == \"Right\" || direction == \"Left\"){\n        sourceMidY = sourceObject.frame.y + sourceObject.frame.height/2\n        childMidY = childObject.frame.y + childObject.frame.height/2\n        diff = sourceMidY - childMidY\n        if(diff > -6 && diff < 6){childObject.frame.y = childObject.frame.y + diff}\n      }\n    \n      if(direction == \"Down\" || direction == \"Up\"){\n        sourceMidX = sourceObject.frame.x + sourceObject.frame.width/2\n        childMidX = childObject.frame.x + childObject.frame.width/2\n        diff = sourceMidX - childMidX\n        if(diff > -6 && diff < 6){childObject.frame.x = childObject.frame.x + diff}\n      }\n    }\n  }\n}\n\nfunction defineSourceObject(firstObjectID, secondObjectID, direction){ //Refactored\n  let firstObject = document.getLayerWithID(firstObjectID)\n  let secondObject = document.getLayerWithID(secondObjectID)\n  let sourceObjectID\n\n  if(direction == \"Right\"){\n    if(firstObject.frame.x <= secondObject.frame.x){\n      sourceObjectID = firstObject.id\n    } else {\n      sourceObjectID = secondObject.id\n    }\n  }\n\n  if(direction == \"Down\"){\n    if(firstObject.frame.y <= secondObject.frame.y){\n      sourceObjectID = firstObject.id\n    } else {\n      sourceObjectID = secondObject.id\n    }\n  }\n\n  if(direction == \"Left\"){\n    if(firstObject.frame.x <= secondObject.frame.x){\n      sourceObjectID = secondObject.id\n    } else {\n      sourceObjectID = firstObject.id\n    }\n  }\n\n  if(direction == \"Up\"){\n    if(firstObject.frame.y <= secondObject.frame.y){\n      sourceObjectID = secondObject.id\n    } else {\n      sourceObjectID = firstObject.id\n    }\n  }\n\n  return sourceObjectID\n}\n\nfunction getSourceObjectFromSelection(selection, direction){ //Refactored\n  let sourceObjectID = selection.firstObject().objectID()\n  \n  if(direction != \"Auto\"){\n    for(let g = 0; g < selection.count(); g++) {\n      sourceObjectID = defineSourceObject(sourceObjectID, selection[g].objectID(), direction)\n    }\n  }\n \n  return sourceObjectID\n}\n\nfunction alertSetup(alert, viewWidth, viewHeight){\n  // Title\n  alert.setMessageText(\"Arrow Plugin Settings\")\n  \n  // Creating dialog buttons\n  alert.addButtonWithTitle(\"Update Settings\")\n  alert.addButtonWithTitle(\"Cancel\")\n  \n  return alert\n}\n\nfunction alertLabel(message, state, x, y, width, height){\n  let infoLabel = NSTextField.alloc().initWithFrame(NSMakeRect(x, y, width, height))\n\n  infoLabel.setStringValue(message)\n  infoLabel.setSelectable(false)\n  infoLabel.setDrawsBackground(false)\n  infoLabel.setBezeled(false)\n\n  if(state == false){\n    infoLabel.textColor = NSColor.disabledControlTextColor()\n  }\n\n  return infoLabel\n}\n\nfunction alertCheckbox(message, state, x, y, width, height){\n  let checkbox = NSButton.alloc().initWithFrame(NSMakeRect(x, y, width, height))\n\n  checkbox.setButtonType(NSSwitchButton)\n  checkbox.setBezelStyle(0)\n  checkbox.setTitle(message)\n  if(Settings.settingForKey(\"autoAlign\")){\n    let currentState = Settings.settingForKey(\"autoAlign\")  \n    checkbox.setState(currentState)\n  } else {\n    checkbox.setState(state)\n  }\n\n  return checkbox\n}\n\nfunction getLayerStyles(name) { // Refactored\n  let allStyles = docData.allLayerStyles()\n  let keyword = \"$arrow\"\n  let styles = []\n\n  for(let i = 0; i < allStyles.count(); i++){\n    if(name == null) {\n      if(allStyles[i].name().includes(keyword)){styles.push(allStyles[i])}\n    } else {\n      if(allStyles[i].name() == name){styles.push(allStyles[i])}\n    }\n  }\n\treturn styles\n}\n\nfunction start(context, direction, isCondition){\n  let selection = context.selection\n\n  if(selection.count() > 1 && selection[0].class() != \"MSArtboardGroup\"){\n    // Need to find source object by ID first\n    let sourceObjectID = getSourceObjectFromSelection(selection, direction)\n    let currentConnectionsData = newConnectionsData // Need to refactor\n\n    for(let g = 0; g < selection.count(); g++) {\n      if(selection[g].objectID() != sourceObjectID){\n        // Then need to create or update connection arrow with each selection\n        let connectionIndex = findConnectionData(sourceObjectID, selection[g].objectID(), currentConnectionsData)\n        \n        if(connectionIndex == null){\n          // There is no connection with this two objects in our database\n          createArrow(sourceObjectID, selection[g].objectID(), null, null, direction, isCondition)\n          sketch.UI.message(\"New connection is created \")\n        } else {\n          // Need to remake the arrow condition\n          updateArrow(sourceObjectID, selection[g].objectID(), null, null, direction, currentConnectionsData[connectionIndex].line, currentConnectionsData[connectionIndex].condition, isCondition, connectionIndex)\n          sketch.UI.message(\"Current connection is updated \")\n        }\n      }\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n  } else {\n    // When user didn't select anything\n    sketch.UI.message(\"Please select more than two layers. Artboards are coming soon \")\n  }\n}\n\nfunction addCondition(keyword, x, y){ // Refactored\n  let libraries = sketch.getLibraries()\n  let libraryObject, symbolReferences, symbol\n\n  for(let g = 0; g < libraries.length; g++) {\n    symbolReferences = libraries[g].getImportableSymbolReferencesForDocument(document)\n    for(let i = 0; i < symbolReferences.length; i++) {\n      if(symbolReferences[i].name.includes(keyword)){\n        libraryObject = symbolReferences[i]\n      }\n    }\n  }\n\n  if(libraryObject == null){\n    symbol = null\n    UI.alert('Condition symbol is not found', 'If you would like to add arrows with specific conditions, you need to specify them in your libraries. You can download the library that works well with the plugin by going into Plugins -> Connection Arrows -> Get Free Library. Conditions are taken from the library based on their names. Make sure to name symbol as \"#condition\" so it will be added here')\n  } else {\n    let symbolMaster = libraryObject.import()\n    symbol = symbolMaster.createNewInstance()\n    addToConditionGroup(symbol, x, y)\n    symbol = symbol.id\n  }\n\n  return symbol\n}\n\nfunction getConnectionPos(firstObject, secondObject, direction){ // Refactored\n\n  let firstObjectAbsPos = firstObject.frame.changeBasis({from: firstObject.parent, to: currentParentGroup})\n  let secondObjectAbsPos = secondObject.frame.changeBasis({from: secondObject.parent, to: currentParentGroup})\n  let currentGroup = checkForGroup(\"Arrows\") \n  let diffX, diffY\n\n  if(currentGroup){\n    diffX = currentGroup.frame().x()\n    diffY = currentGroup.frame().y()\n  } else {\n    diffX = 0\n    diffY = 0\n  }\n\n  let connectionPos = {\n    firstLayerPosX: null, \n    firstLayerPosY: null, \n    secondLayerPosX: null, \n    secondLayerPosY: null, \n    middlePosX: null, \n    middlePosY: null\n  }\n\n  // Getting all the positions\n  if(direction == \"Up\"){\n    // First Layer Position Start Point Position\n    connectionPos.firstLayerPosX = firstObjectAbsPos.x+firstObjectAbsPos.width/2-diffX\n    connectionPos.firstLayerPosY = firstObjectAbsPos.y-diffY\n\n    // Second Layer Position End Point Position\n    connectionPos.secondLayerPosX = secondObjectAbsPos.x+secondObjectAbsPos.width/2-diffX\n    connectionPos.secondLayerPosY = secondObjectAbsPos.y+secondObjectAbsPos.height-diffY\n\n    // Middle Points\n    connectionPos.middlePosX = (connectionPos.firstLayerPosX + connectionPos.secondLayerPosX)/2\n    connectionPos.middlePosY = (connectionPos.firstLayerPosY + connectionPos.secondLayerPosY)/2\n  }\n\n  if(direction == \"Right\"){\n    // First Layer Position Start Point Position\n    connectionPos.firstLayerPosX = firstObjectAbsPos.x+firstObjectAbsPos.width-diffX\n    connectionPos.firstLayerPosY = firstObjectAbsPos.y+firstObjectAbsPos.height/2-diffY\n\n    // Second Layer Position End Point Position\n    connectionPos.secondLayerPosX = secondObjectAbsPos.x-diffX\n    connectionPos.secondLayerPosY = secondObjectAbsPos.y+secondObjectAbsPos.height/2-diffY\n    \n    // Middle Points\n    connectionPos.middlePosX = (connectionPos.firstLayerPosX + connectionPos.secondLayerPosX)/2\n    connectionPos.middlePosY = (connectionPos.firstLayerPosY + connectionPos.secondLayerPosY)/2\n  }\n\n  if(direction == \"Down\"){\n    // First Layer Position Start Point Position\n    connectionPos.firstLayerPosX = firstObjectAbsPos.x+firstObjectAbsPos.width/2-diffX\n    connectionPos.firstLayerPosY = firstObjectAbsPos.y+firstObjectAbsPos.height-diffY\n\n    // Second Layer Position End Point Position\n    connectionPos.secondLayerPosX = secondObjectAbsPos.x+secondObjectAbsPos.width/2-diffX\n    connectionPos.secondLayerPosY = secondObjectAbsPos.y-diffY\n\n    // Middle Points\n    connectionPos.middlePosX = (connectionPos.firstLayerPosX + connectionPos.secondLayerPosX)/2\n    connectionPos.middlePosY = (connectionPos.firstLayerPosY + connectionPos.secondLayerPosY)/2\n  }\n\n  if(direction == \"Left\"){\n    // First Layer Position Start Point Position\n    connectionPos.firstLayerPosX = firstObjectAbsPos.x-diffX\n    connectionPos.firstLayerPosY = firstObjectAbsPos.y+firstObjectAbsPos.height/2-diffY\n\n    // Second Layer Position End Point Position\n    connectionPos.secondLayerPosX = secondObjectAbsPos.x+secondObjectAbsPos.width-diffX\n    connectionPos.secondLayerPosY = secondObjectAbsPos.y+secondObjectAbsPos.height/2-diffY\n\n    // Middle Points\n    connectionPos.middlePosX = (connectionPos.firstLayerPosX + connectionPos.secondLayerPosX)/2\n    connectionPos.middlePosY = (connectionPos.firstLayerPosY + connectionPos.secondLayerPosY)/2\n  }\n\n  return connectionPos\n}\n\nfunction drawStraightLine(firstLayerPosX, firstLayerPosY, secondLayerPosX, secondLayerPosY, direction){ // Refactored\n  let path = NSBezierPath.bezierPath()\n  \n  if(direction == \"Up\"){\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n  }\n\n  if(direction == \"Right\"){\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n  }\n\n  if(direction == \"Down\"){\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n  }\n\n  if(direction == \"Left\"){\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n  }\n\n  let line = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n  line.setName(\"Straight Arrow\")\n\n  return line\n}\n\nfunction drawAngledLine(firstLayerPosX, firstLayerPosY, middlePosX, middlePosY, secondLayerPosX, secondLayerPosY, direction){ // Refactored\n  let path = NSBezierPath.bezierPath()\n\n  if(direction == \"Up\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX, firstLayerPosY))\n    path.lineToPoint(NSMakePoint(firstLayerPosX, middlePosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX, middlePosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX, secondLayerPosY))\n  }\n\n  if(direction == \"Right\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX, firstLayerPosY))\n    path.lineToPoint(NSMakePoint(middlePosX, firstLayerPosY))\n    path.lineToPoint(NSMakePoint(middlePosX, secondLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX, secondLayerPosY))\n  }\n\n  if(direction == \"Down\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX, firstLayerPosY))\n    path.lineToPoint(NSMakePoint(firstLayerPosX, middlePosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX, middlePosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX, secondLayerPosY))\n  }\n\n  if(direction == \"Left\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX, firstLayerPosY))\n    path.lineToPoint(NSMakePoint(middlePosX, firstLayerPosY))\n    path.lineToPoint(NSMakePoint(middlePosX, secondLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX, secondLayerPosY))\n  }\n\n  let line = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n  let points = line.layers().firstObject().points()\n  points[1].cornerRadius = 20\n  points[2].cornerRadius = 20\n  line.setName(\"Angled Arrow\")\n\n  return line\n}\n\nfunction drawCurvedLine(firstLayerPosX, firstLayerPosY, secondLayerPosX, secondLayerPosY, direction){ // Refactored\n  let path = NSBezierPath.bezierPath()\n  let line\n\n  if(direction == \"Up\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n\n    // Painting the line\n    line = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n    let points = line.layers().firstObject().points()\n\n    points[0].curveMode = points[1].curveMode = 4\n    points[0].hasCurveFrom = points[1].hasCurveTo = true\n\n    if(firstLayerPosX<secondLayerPosX){\n      points[0].curveFrom = {x: 0, y: 0.5}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 1,y: 0.5}\n    } else {\n      points[0].curveFrom = {x: 1, y: 0.5}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 0,y: 0.5}\n    }\n  }\n\n  if(direction == \"Right\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n\n    // Painting the line\n    line = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n    let points = line.layers().firstObject().points()\n\n    points[0].curveMode = points[1].curveMode = 4\n    points[0].hasCurveFrom = points[1].hasCurveTo = true\n\n    if(firstLayerPosY<secondLayerPosY){\n      points[0].curveFrom = {x: 0.5, y: 0}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 0.5,y: 1}\n    } else {\n      points[0].curveFrom = {x: 0.5, y: 1}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 0.5,y: 0}\n    }\n  }\n\n  if(direction == \"Down\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n\n    // Painting the line\n    line = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n    let points = line.layers().firstObject().points()\n\n    points[0].curveMode = points[1].curveMode = 4\n    points[0].hasCurveFrom = points[1].hasCurveTo = true\n\n    if(firstLayerPosX<secondLayerPosX){\n      points[0].curveFrom = {x: 0, y: 0.5}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 1,y: 0.5}\n    } else {\n      points[0].curveFrom = {x: 1, y: 0.5}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 0,y: 0.5}\n    }\n  }\n\n  if(direction == \"Left\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n\n    // Painting the line\n    line = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n    let points = line.layers().firstObject().points()\n\n    points[0].curveMode = points[1].curveMode = 4\n    points[0].hasCurveFrom = points[1].hasCurveTo = true\n\n    if(firstLayerPosY<secondLayerPosY){\n      points[0].curveFrom = {x: 0.5, y: 0}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 0.5,y: 1}\n    } else {\n      points[0].curveFrom = {x: 0.5, y: 1}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 0.5,y: 0}\n    }\n  }\n\n  // Providing Settings for the arrow\n  line.setName(\"Curved Arrow\")\n\n  return line\n}\n\nfunction styleLine(line, style){ // Refactored\n  let localStyle\n  \n  if(style != null){ \n    // For updates\n    if(getLayerStyles(style) != null && style != \"Default Style\"){\n      // If style is specified\n      localStyle = style\n      let ownStyle = getLayerStyles(style)\n      line.sharedStyle = ownStyle[0]\n    } else {\n      // if there is no specific style\n      localStyle = \"Default Style\"\n      let border = line.style().addStylePartOfType(1)\n      border.color = MSColor.colorWithRGBADictionary({r: 0.89, g: 0.89, b: 0.89, a: 1})\n      border.thickness = 2\n      line.style().endMarkerType = 2\n    }\n  } else {\n    // For creating new\n    if(context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey) != null && context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey) != \"Default Style\"){\n      // we have settins almost all the time and it's not default\n      localStyle = getLayerStyles(context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey))\n      line.sharedStyle = localStyle[0]\n      localStyle = localStyle[0].name()\n    } else {\n      localStyle = \"Default Style\"\n      let border = line.style().addStylePartOfType(1)\n      border.color = MSColor.colorWithRGBADictionary({r: 0.89, g: 0.89, b: 0.89, a: 1})\n      border.thickness = 2\n      line.style().endMarkerType = 2\n    } \n  }\n\n  return localStyle\n}\n\n\n\n\n\n","module.exports = require(\"sketch\");","module.exports = require(\"sketch/dom\");","module.exports = require(\"sketch/settings\");","module.exports = require(\"sketch/ui\");"],"sourceRoot":""}