{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./src/script.js","webpack://exports/external \"sketch\"","webpack://exports/external \"sketch/dom\"","webpack://exports/external \"sketch/settings\"","webpack://exports/external \"sketch/ui\""],"names":["UI","require","pluginKey","document","docData","pluginData","currentParentGroup","newConnectionsData","context","sketch","fromNative","documentData","command","valueForKey_onLayer_forPluginIdentifier","currentPage","currentArtboard","getConnectionsData","actionContext","Settings","createAutoArrow","start","createRightArrow","createDownArrow","createLeftArrow","createUpArrow","createRightArrowWithCondition","createDownArrowWithCondition","createLeftArrowWithCondition","createUpArrowWithCondition","updateSelectedArrows","selection","count","class","currentConnectionsData","g","objectID","connectionIndex","findConnectionIndex","length","updateArrow","firstObject","secondObject","style","type","direction","line","condition","isCondition","message","setValue_forKey_onLayer_forPluginIdentifier","autoUpdateSelectedArrows","action","movedLayers","Array","from","layers","map","layer","log","id","updateArtboardArrows","connections","firstObjectArtboard","secondObjectArtboard","updateArrowsCounter","i","getLayerWithID","sketchObject","parentArtboard","push","updateAllArrows","deleteAllArrows","deleteLine","deleteArtboardArrows","deleteConnectionFromData","deleteSelectedArrows","settings","alert","COSAlertWindow","new","viewWidth","viewHeight","alertSetup","view","NSView","alloc","initWithFrame","NSMakeRect","addAccessoryView","arrowStyleLabel","alertLabel","addSubview","arrowStylingField","NSPopUpButton","setActiveStyleSetting","arrowStyleInfoLabel","arrowTypeLabel","arrowTypeField","setActiveTypeSetting","arrowTypeInfoLabel","arrowSpacingLabel","arrowSpacingPxLabel","arrowSpacingField","NSTextField","formatter","NSNumberFormatter","init","autorelease","setStringValue","String","settingForKey","setFormatter","arrowSpacingStepper","NSStepper","setMaxValue","setMinValue","setValueWraps","setAutorepeat","setCOSJSTargetFunction","sender","value","integerValue","arrowSpacingInfoLabel","otherSettingsLabel","checkbox","alertCheckbox","autoAlignInfoLabel","pluginInfoLabel","modalResponse","runModal","NSAlertFirstButtonReturn","views","subviews","title","setSettingForKey","intValue","state","onLayersMoved","panel","ControlBar","NSPanel","setStyleMask","NSTitledWindowMask","NSFullSizeContentViewWindowMask","setTitleVisibility","NSWindowTitleHidden","setTitlebarAppearsTransparent","setFrame_display","setMovableByWindowBackground","setHasShadow","setLevel","NSFloatingWindowLevel","center","makeKeyAndOrderFront","nil","firstObjectID","secondObjectID","lineID","conditionID","conditionObject","remove","createArrow","localDirection","getDirection","updateSpacing","autoAlignLayer","arrow","drawConnection","connection","checkForGroup","groupName","currentGroup","name","firstObjectMidX","frame","x","width","firstObjectMidY","y","height","secondObjectMidX","secondObjectMidY","diffX","diffY","absDiffX","Math","abs","absDiffY","connectionPos","getConnectionPos","drawAngledLine","firstLayerPosX","firstLayerPosY","middlePosX","middlePosY","secondLayerPosX","secondLayerPosY","drawStraightLine","drawCurvedLine","updateCondition","addCondition","styleLine","addToArrowsGroup","addLayers","fixGeometryWithOptions","Group","group","parent","locked","moveToBack","adjustToFit","addToConditionGroup","conGroup","arGroup","arGroupX","arGroupY","dataArray","data","indexArray","docSettings","styles","getLayerStyles","addItemWithTitle","docTypeSettings","lastItem","setState","newConnections","lineObject","selectedGroup","sourceObjectID","childObjectID","sourceObject","childObject","currentSpacing","sourceMidY","childMidY","sourceMidX","childMidX","diff","defineSourceObject","getSourceObjectFromSelection","setMessageText","addButtonWithTitle","infoLabel","setSelectable","setDrawsBackground","setBezeled","textColor","NSColor","disabledControlTextColor","NSButton","setButtonType","NSSwitchButton","setBezelStyle","setTitle","currentState","allStyles","allLayerStyles","keyword","includes","libraries","getLibraries","libraryObject","symbolReferences","symbol","getImportableSymbolReferencesForDocument","symbolMaster","import","createNewInstance","firstObjectAbsPos","changeBasis","to","secondObjectAbsPos","path","NSBezierPath","bezierPath","moveToPoint","NSMakePoint","lineToPoint","MSShapeGroup","layerWithPath","MSPath","pathWithBezierPath","setName","points","cornerRadius","curveMode","hasCurveFrom","hasCurveTo","curveFrom","curveTo","localStyle","ownStyle","sharedStyle","border","addStylePartOfType","color","MSColor","colorWithRGBADictionary","r","b","a","thickness","endMarkerType"],"mappings":"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","file":"script.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/script.js\");\n","import sketch from 'sketch'\nlet UI = require('sketch/ui') \n\n\n//\n//  Variables\n//\n\n\n\nconst pluginKey = \"flowArrows\"\nlet document\n\nlet docData, pluginData, currentParentGroup, newConnectionsData\nif(context.document){\n  document = sketch.fromNative(context.document)\n  docData = context.document.documentData()\n  pluginData = context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowConnections\", docData, pluginKey)\n  currentParentGroup = docData.currentPage().currentArtboard() || docData.currentPage() // TODO: Might be a problem for multiple artboards\n  newConnectionsData = getConnectionsData()\n} else {\n  document = sketch.fromNative(context.actionContext.document)\n}\n\n// const action = context.actionContext\n// docData = action.document.documentData()\n\n\n// Settings\nvar Settings = require('sketch/settings')\n\n  \n//\n//  Create Connection Function\n//\n\n\nexport function createAutoArrow(context){start(context, \"Auto\", false)}\nexport function createRightArrow(context){start(context, \"Right\", false)}\nexport function createDownArrow(context){start(context, \"Down\", false)}\nexport function createLeftArrow(context){start(context, \"Left\", false)}\nexport function createUpArrow(context){start(context, \"Up\", false)}\n\nexport function createRightArrowWithCondition(context){start(context, \"Right\", true)}\nexport function createDownArrowWithCondition(context){start(context, \"Down\", true)}\nexport function createLeftArrowWithCondition(context){start(context, \"Left\", true)}\nexport function createUpArrowWithCondition(context){start(context, \"Up\", true)}\n\n//\n// Plugin Commands\n//\n\nexport function updateSelectedArrows(context) {\n  let selection = context.selection\n\n  if(selection.count() > 1 && selection[0].class() != \"MSArtboardGroup\"){\n    // Need to find source object by ID first\n    let currentConnectionsData = newConnectionsData // Need to refactor\n\n    for(let g = 0; g < selection.count(); g++) {\n      if(selection[g].objectID() != selection[0].objectID()){\n        // Then need to create or update connection arrow with each selection\n        let connectionIndex = findConnectionIndex(selection[0].objectID(), selection[g].objectID(), currentConnectionsData)\n\n        if(connectionIndex.length == 0){\n          updateArrow(currentConnectionsData[connectionIndex].firstObject, currentConnectionsData[connectionIndex].secondObject, currentConnectionsData[connectionIndex].style, currentConnectionsData[connectionIndex].type, currentConnectionsData[connectionIndex].direction, currentConnectionsData[connectionIndex].line, currentConnectionsData[connectionIndex].condition, currentConnectionsData[connectionIndex].isCondition, connectionIndex)\n          sketch.UI.message(\"Current connection is updated 🤘\")\n        } else {\n          sketch.UI.message(\"There is no connection between selected layers on the plugin data\")\n        }\n      }\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n    \n  } else {\n    // When user didn't select anything\n    sketch.UI.message(\"Please select more than two layers. Artboards are coming soon 🥳\")\n  }\n}\n\nexport function autoUpdateSelectedArrows(context) {  \n  const action = context.actionContext\n\n  docData = action.document.documentData()\n  pluginData = context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowConnections\", docData, pluginKey)\n  currentParentGroup = docData.currentPage().currentArtboard() || docData.currentPage() // TODO: Might be a problem for multiple artboards\n  newConnectionsData = getConnectionsData()\n\n  const movedLayers = Array.from(context.actionContext.layers).map(layer => sketch.fromNative(layer))\n  log(movedLayers[0].id)\n  log(movedLayers.length)\n\n  // if (movedLayers.filter(layer => (layer.type == 'Artboard' || (layer.type == 'SymbolMaster' && config.arrangeSymbols))).length > 0) {\n  //   ArrangeArtboards(context)\n  // }\n\n  let currentConnectionsData = newConnectionsData // Need to refactor\n\n  for(let g = 0; g < movedLayers.length; g++) {\n\n    let connectionIndex = findConnectionIndex(movedLayers[0].id, null, currentConnectionsData)\n\n    log(\"yes \"+connectionIndex)\n    if(connectionIndex.length == 0){\n      \n      updateArrow(currentConnectionsData[connectionIndex[0]].firstObject, currentConnectionsData[connectionIndex[0]].secondObject, currentConnectionsData[connectionIndex[0]].style, currentConnectionsData[connectionIndex[0]].type, currentConnectionsData[connectionIndex[0]].direction, currentConnectionsData[connectionIndex[0]].line, currentConnectionsData[connectionIndex[0]].condition, currentConnectionsData[connectionIndex[0]].isCondition, connectionIndex[0])\n      sketch.UI.message(\"Current connection is updated 🤘\")\n    } else {\n      sketch.UI.message(\"There is no connection between selected layers on the plugin data\")\n    }\n    \n  }\n  context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n}\n\n\nexport function updateArtboardArrows(context) {\n  // TODO: Need to show amount of updated arrows and deleted ones\n  let selection = context.selection\n  let connections = getConnectionsData()\n  let firstObjectArtboard\n  let secondObjectArtboard\n  \n  if(connections.length > 0){\n    // We have connections in database\n    const updateArrowsCounter = connections.length\n    for (let i = 0; i < updateArrowsCounter; i ++) {\n      // Need to check if the element is selected globally or from the artboard\n      firstObjectArtboard = document.getLayerWithID(connections[i].firstObject)\n      firstObjectArtboard = firstObjectArtboard.sketchObject.parentArtboard().objectID()\n\n      secondObjectArtboard = document.getLayerWithID(connections[i].secondObject)\n      secondObjectArtboard = secondObjectArtboard.sketchObject.parentArtboard().objectID()\n\n      if(selection.count() == 1 && selection[0].class() == \"MSArtboardGroup\"){\n        // Need to go through each connection and update arrow position for specific artboard\n        \n        if (firstObjectArtboard == selection[0].objectID()){\n          if (secondObjectArtboard == selection[0].objectID()){\n            updateArrow(connections[i].firstObject, connections[i].secondObject, connections[i].style, connections[i].type, connections[i].direction, connections[i].line, connections[i].condition, i)\n          } else {newConnectionsData.push(connections[i])}\n        } else {\n          // If not just saving it\n          newConnectionsData.push(connections[i])\n        }\n      }\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n    sketch.UI.message(\"All arrows are updated 🚀\")\n  } else {\n    // We don't have any connections to update\n    sketch.UI.message(\"There is nothing to update\")\n  }\n}\n\nexport function updateAllArrows(context) { // TODO\n  // TODO: Need to show amount of updated arrows and deleted ones\n  let currentConnectionsData = newConnectionsData\n  if(currentConnectionsData.length > 0){\n    // We have connections in database\n    const updateArrowsCounter = currentConnectionsData.length\n    for (let i = 0; i < updateArrowsCounter; i ++) {\n      // Need to go through each connection and update arrow position without artboards\n      // Need to check if current object don't have the parrent\n      updateArrow(currentConnectionsData[i].firstObject, currentConnectionsData[i].secondObject, currentConnectionsData[i].style, currentConnectionsData[i].type, currentConnectionsData[i].direction, currentConnectionsData[i].line, currentConnectionsData[i].condition, i)\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n    sketch.UI.message(\"All arrows are updated 🚀\")\n  } else {\n    // We don't have any connections to update\n    sketch.UI.message(\"There is nothing to update\")\n  }\n}\n\nexport function deleteAllArrows(context) {\n\n  if(newConnectionsData.length > 0){\n    // We have connections in database\n    for (let i = 0; i < newConnectionsData.length; i ++) {\n      // Need to go through each connection and update arrow position\n      deleteLine(newConnectionsData[i].line)\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(null, \"arrowConnections\", docData, pluginKey)\n    sketch.UI.message(\"All arrows are deleted\")\n  } else {\n    // We don't have any connections to update\n    sketch.UI.message(\"There is nothing to delete\")\n  }\n}\n\nexport function deleteArtboardArrows(context) {\n  let selection = context.selection\n  let firstObject, secondObject\n\n  // Need to delete all the arrows only from selected artboard\n  if(selection.count() == 1 && selection[0].class() == \"MSArtboardGroup\"){\n    let connections = getConnectionsData()\n    \n    if(connections.length > 0){\n      // We have connections in database\n      const updateArrowsCounter = connections.length\n      for (let i = 0; i < updateArrowsCounter; i ++) {\n        // Need to go through each connection and check if it placed on selected artboard\n        firstObject = document.getLayerWithID(connections[i].firstObject)\n        secondObject = document.getLayerWithID(connections[i].secondObject)\n        if (firstObject.sketchObject.parentArtboard().objectID() == selection[0].objectID()){\n          if (secondObject.sketchObject.parentArtboard().objectID() == selection[0].objectID()){\n            deleteLine(connections[i].line)\n            newConnectionsData = deleteConnectionFromData(i)\n          }\n        }\n      }\n      context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n      sketch.UI.message(\"All arrows from selected artboard are deleted\")\n    } else {\n      // We don't have any connections to update\n      sketch.UI.message(\"There is nothing to delete\")\n    }\n  } else {\n    sketch.UI.message(\"Please select one artboard\")\n  }\n}\n\nexport function deleteSelectedArrows(context) {\n  let selection = context.selection\n  let firstObject, secondObject\n\n  if(selection.count() == 2){\n\n    for(let g = 0; g < selection.count(); g++) {\n\n      if(selection[g].objectID() != selection[0].objectID()){ // It will never check 3rd connection\n        \n        let connections = getConnectionsData() \n        let connectionIndex = findConnectionIndex(selection[0].objectID(), selection[g].objectID(), connections)\n        \n        if(connectionIndex != null){\n          // We have connections in database\n          deleteLine(connections[connectionIndex].line)\n          newConnectionsData = deleteConnectionFromData(connectionIndex)\n          const updateArrowsCounter = connections.length\n          for (let i = 0; i < updateArrowsCounter; i ++) {\n            // Need to go through each connection and check if it placed on selected artboard\n            firstObject = document.getLayerWithID(connections[i].firstObject)\n            secondObject = document.getLayerWithID(connections[i].secondObject)\n            if(firstObject.sketchObject.parentArtboard().objectID() == selection[0].objectID()){\n              if(secondObject.sketchObject.parentArtboard().objectID() == selection[0].objectID()){\n                deleteLine(connections[i].line)\n                newConnectionsData = deleteConnectionFromData(i)\n              }\n            }\n          }\n          context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n          sketch.UI.message(\"All arrows from selected layers are deleted ✌️\")\n        }\n      }\n    }\n  } else {\n    sketch.UI.message(\"Select two layers, please 🧐\")\n  }\n}\n\nexport function settings(context) {\n  let alert = COSAlertWindow.new()\n  const viewWidth = 300\n  const viewHeight = 450\n  \n  // Alert window settings\n  alert = alertSetup(alert, viewWidth, viewHeight)\n  let view = NSView.alloc().initWithFrame(NSMakeRect(0, 0, viewWidth, viewHeight))\n  alert.addAccessoryView(view)\n\n  // Label: Arrow Style\n  let arrowStyleLabel = alertLabel(\"Arrow Style\", true, -1, viewHeight-40, 280, 40)\n  view.addSubview(arrowStyleLabel)\n\n  // Select: Arrow Style\n  let arrowStylingField = NSPopUpButton.alloc().initWithFrame(NSMakeRect(-2, viewHeight - 40, 300, 20));\n  setActiveStyleSetting(arrowStylingField)\n  view.addSubview(arrowStylingField)\n\n  // Label: Arrow Style Info\n  let arrowStyleInfoLabel = alertLabel(\"Add layer style to your document that will contain $arrow name and you will be able to specify it here \", false, -1, viewHeight-80, 300, 40)\n  view.addSubview(arrowStyleInfoLabel)\n\n\n  // Label: Arrow Type\n  let arrowTypeLabel = alertLabel(\"Arrow Type\", true, -1, viewHeight-130, 280, 40)\n  view.addSubview(arrowTypeLabel)\n\n  // Select: Arrow Type\n  let arrowTypeField = NSPopUpButton.alloc().initWithFrame(NSMakeRect(-2, viewHeight - 130, 300, 20));\n  setActiveTypeSetting(arrowTypeField)\n  view.addSubview(arrowTypeField)\n\n  // Label: Arrow Type Info\n  let arrowTypeInfoLabel = alertLabel(\"Select one of the arrow types. Angled is used by default\", false, -1, viewHeight-170, 300, 40)\n  view.addSubview(arrowTypeInfoLabel)\n\n\n  // Label: Arrow Spacing\n  let arrowSpacingLabel = alertLabel(\"Arrow Spacing\", true, -1, viewHeight - 200, 330, 20)\n  view.addSubview(arrowSpacingLabel)\n\n  // Label: Arrow Spacing PX\n  let arrowSpacingPxLabel = alertLabel(\"px\", true, 90, viewHeight - 220, 330, 20)\n  view.addSubview(arrowSpacingPxLabel)\n\n  // Input: Arrow Spacing\n  let arrowSpacingField = NSTextField.alloc().initWithFrame(NSMakeRect(-2, viewHeight - 220, 80, 20))\n  var formatter = NSNumberFormatter.alloc().init().autorelease()\n  arrowSpacingField.setStringValue(String(Settings.settingForKey(\"arrowSpacing\")))\n  arrowSpacingField.setFormatter(formatter)\n  view.addSubview(arrowSpacingField)\n\n  // Stepper: Arrow Spacing\n  let arrowSpacingStepper = NSStepper.alloc().initWithFrame(NSMakeRect(70, viewHeight - 220, 20, 20));\n  arrowSpacingStepper.setMaxValue(1000)\n  arrowSpacingStepper.setMinValue(0)\n  arrowSpacingStepper.setValueWraps(false)\n  arrowSpacingStepper.setAutorepeat(true)\n  arrowSpacingStepper.setCOSJSTargetFunction(function(sender){\n    var value = 0 + sender.integerValue()\n    arrowSpacingField.setStringValue(String(value))\n  })\n  \n  view.addSubview(arrowSpacingStepper)\n  // view.addSubview(formatter)\n  \n  // Label: Auto Spacing Info\n  let arrowSpacingInfoLabel = alertLabel(\"The second layer will be moved closer based on the value provided here. Keep it 0 if you don't want to have auto spacing feature \", false, -1, viewHeight-285, 300, 60)\n  view.addSubview(arrowSpacingInfoLabel)\n\n  // Label: Other Settings\n  let otherSettingsLabel = alertLabel(\"Other Settings\", true, -1, viewHeight-330, 280, 40)\n  view.addSubview(otherSettingsLabel)\n\n  // Checkbox: Auto-Align\n  let checkbox = alertCheckbox(\"Second layer auto-align\", false, -1, viewHeight-340, 260, 40)\n  view.addSubview(checkbox)\n\n  // Label: Auto-Align Info\n  let autoAlignInfoLabel = alertLabel(\"Align the second layer for 5px misalignment with the first one\", false, -1, viewHeight-370, 280, 40)\n  view.addSubview(autoAlignInfoLabel)\n\n  // Label: Plugin Info\n  let pluginInfoLabel = alertLabel(\"Made by @faridSabitov with the support of EPAM.com ❤️\", true, -1, viewHeight-420, 280, 40)\n  view.addSubview(pluginInfoLabel)\n\n\n  // Need to check if style is still available\n\n  // Show modal and get the results\n  let modalResponse = alert.runModal()\n\n  if(modalResponse == NSAlertFirstButtonReturn){\n    // When user clicks on \"Update Settings\"\n    // Need to save all this results into the Plugin Settings\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(alert.views()[0].subviews()[1].title(), \"arrowStyle\", docData, pluginKey)\n    Settings.setSettingForKey(\"arrowType\", alert.views()[0].subviews()[4].title())\n    Settings.setSettingForKey(\"arrowSpacing\", alert.views()[0].subviews()[8].intValue())\n    Settings.setSettingForKey(\"autoAlign\", alert.views()[0].subviews()[12].state())\n    UI.message(\"Settings are updated 🚀\")\n  }\n}\n\nexport function onLayersMoved(context) {\n  sketch.UI.message(\"Please select more than two layers\")\n  const action = context.actionContext  \n}\n\nexport function panel(context) {\n  let ControlBar\n  ControlBar = NSPanel.alloc().init();\n  ControlBar.setStyleMask(NSTitledWindowMask + NSFullSizeContentViewWindowMask);\n  // ControlBar.setBackgroundColor(NSColor.colorWithRed_green_blue_alpha(0.99, 0.99, 0.99, 1));\n  ControlBar.setTitleVisibility(NSWindowTitleHidden);\n  ControlBar.setTitlebarAppearsTransparent(true);\n  ControlBar.setFrame_display(NSMakeRect(0, 0, 720, 50), false);\n  ControlBar.setMovableByWindowBackground(true);\n  ControlBar.setHasShadow(true);\n  ControlBar.setLevel(NSFloatingWindowLevel);\n\n  // contentView.addSubview(closeButton)\n  ControlBar.center();\n  ControlBar.makeKeyAndOrderFront(nil);\n\n//   getImage = function(size, name){\n//     var isRetinaDisplay = (NSScreen.mainScreen().backingScaleFactor() > 1)? true: false;\n//         suffix = (isRetinaDisplay)? \"@2x\": \"\",\n//         imageURL = NSURL.fileURLWithPath(self.pluginResources + \"/icons/\" + name + suffix + \".png\"),\n//         image = NSImage.alloc().initWithContentsOfURL(imageURL);\n//     return image\n// },\n// addButton = function(rect, name, callAction){\n//     var button = NSButton.alloc().initWithFrame(rect),\n//         image = getImage(rect.size, name);\n\n//     button.setImage(image);\n//     button.setBordered(false);\n//     button.sizeToFit();\n//     button.setButtonType(NSMomentaryChangeButton);\n//     button.setCOSJSTargetFunction(callAction);\n//     button.setAction(\"callAction:\");\n//     return button;\n// },\n// addImage = function(rect, name){\n//     var view = NSImageView.alloc().initWithFrame(rect),\n//         image = getImage(rect.size, name);\n//     view.setImage(image);\n//     return view;\n// },\n\n// closeButton = addButton( NSMakeRect(20, 10, 30, 30), \"close-control\",\n//     function(sender){\n//         coscript.setShouldKeepAround(false);\n//         threadDictionary.removeObjectForKey(identifier);\n//         ControlBar.close();\n// }),\n\n\n\n}\n\n//\n// Functions\n//\n\nfunction updateArrow(firstObjectID, secondObjectID, style, type, direction, lineID, conditionID, isCondition, connectionIndex) { // Refactored\n  // Need to check if we have the layers with such IDs\n  let firstObject = document.getLayerWithID(firstObjectID)\n  let secondObject = document.getLayerWithID(secondObjectID)\n  let conditionObject = document.getLayerWithID(conditionID)\n  \n  // Need to delete data first, because we will have a new line\n  deleteLine(lineID)\n  if(conditionID && !isCondition){\n    if(conditionObject){conditionObject.remove()}\n  }\n  \n  newConnectionsData = deleteConnectionFromData(connectionIndex)\n\n  if(firstObject && secondObject){\n    // If we have all the objects, we can recreate the line\n    createArrow(firstObjectID, secondObjectID, style, type, direction, conditionID, isCondition)\n  } \n}\n\nfunction createArrow(firstObjectID, secondObjectID, style, type, direction, conditionID, isCondition) {  // Refactored\n  let localDirection = direction == \"Auto\" ? getDirection(firstObjectID, secondObjectID) : direction\n\n  // Main Operations based on the settings\n  updateSpacing(firstObjectID, secondObjectID, localDirection)\n  autoAlignLayer(firstObjectID, secondObjectID, localDirection)\n\n  // Making an Arrow \n  let arrow = drawConnection(firstObjectID, secondObjectID, style, type, localDirection, conditionID, isCondition)\n  \n  // Storage for current connection\n  let connection = {\n    firstObject : firstObjectID,\n    secondObject : secondObjectID,\n    style : arrow.style,\n    condition : arrow.conditionID,\n    isCondition : isCondition,\n    type : arrow.type,\n    direction: localDirection,\n    line : arrow.line.objectID()\n  }\n\n  // Need to save this data to the global array\n  newConnectionsData.push(connection)\n}\n\nfunction checkForGroup(groupName) { // refactored\n  let currentGroup = null\n\n  // Checking all the groups that we have\n  for(let i = 0; i < currentParentGroup.layers().count(); i++){\n    if(currentParentGroup.layers()[i].name() == groupName) {\n      currentGroup = currentParentGroup.layers()[i]\n    } \n  }\n\n  return currentGroup\n}\n\nfunction getDirection(firstObjectID, secondObjectID){ // Refactored\n  // Get direction from the source object\n  const firstObject = document.getLayerWithID(firstObjectID)\n  const secondObject = document.getLayerWithID(secondObjectID)\n  const firstObjectMidX = firstObject.frame.x+firstObject.frame.width/2\n  const firstObjectMidY = firstObject.frame.y+firstObject.frame.height/2\n  const secondObjectMidX = secondObject.frame.x+secondObject.frame.width/2\n  const secondObjectMidY = secondObject.frame.y+secondObject.frame.height/2\n\n  const diffX = firstObjectMidX - secondObjectMidX\n  const diffY = firstObjectMidY - secondObjectMidY\n  const absDiffX = Math.abs(diffX) \n  const absDiffY = Math.abs(diffY)\n  let direction\n\n  if(secondObjectMidX > firstObjectMidX){\n    // Right Half\n    if(secondObjectMidY > firstObjectMidY){\n      // Bottom quarter\n      direction = diffX > diffY ? \"Down\" : \"Right\"\n    } else {\n      // Top quarter\n      direction = absDiffX > absDiffY ? \"Right\" : \"Up\"\n    }\n  } else {\n    // Left Half\n    if(secondObjectMidY > firstObjectMidY){\n      // Bottom quarter\n      direction = absDiffX > absDiffY ? \"Left\" : \"Down\"\n    } else {\n      // Top quarter\n      direction = diffX > diffY ? \"Left\" : \"Up\"\n    }\n  }\n\n  return direction\n}\n\nfunction drawConnection(firstObjectID, secondObjectID, style, type, localDirection, conditionID, condition){ // Refactored\n  // Process of creating new connection  \n  let firstObject = document.getLayerWithID(firstObjectID)\n  let secondObject = document.getLayerWithID(secondObjectID)\n  let connectionPos = getConnectionPos(firstObject, secondObject, localDirection)\n  let connection = {\n    line: [], \n    conditionID: [],\n    type: [],\n    style: []\n  }\n\n  // Type  \n  connection.type = type == null ? Settings.settingForKey(\"arrowType\") : type\n  if(connection.type == \"Angled\" || connection.type == null){ connection.line = drawAngledLine(connectionPos.firstLayerPosX, connectionPos.firstLayerPosY, connectionPos.middlePosX, connectionPos.middlePosY, connectionPos.secondLayerPosX, connectionPos.secondLayerPosY, localDirection)}\n  if(connection.type == \"Straight\"){ connection.line = drawStraightLine(connectionPos.firstLayerPosX, connectionPos.firstLayerPosY, connectionPos.secondLayerPosX, connectionPos.secondLayerPosY, localDirection)}\n  if(connection.type == \"Curved\"){ connection.line = drawCurvedLine(connectionPos.firstLayerPosX, connectionPos.firstLayerPosY, connectionPos.secondLayerPosX, connectionPos.secondLayerPosY, localDirection)}\n\n  // Condition\n  if(condition == true){\n    if(conditionID != null){\n      connection.conditionID = updateCondition(conditionID, connectionPos.middlePosX, connectionPos.middlePosY)\n    } else {\n      connection.conditionID = addCondition(\"#con\", connectionPos.middlePosX, connectionPos.middlePosY)\n    }\n  } else {\n    connection.conditionID = null\n  }\n  // connection.conditionID = condition != false ? connection.conditionID = addCondition(\"#con\", connectionPos.middlePosX, connectionPos.middlePosY) : connection.conditionID = null\n\n  // Style\n  connection.style = styleLine(connection.line, style)\n\n  // Add to group\n  addToArrowsGroup(connection.line)\n  \n  return connection\n}\n\nfunction addToArrowsGroup(line){\n  let currentGroup = checkForGroup(\"Arrows\")\n  if(currentGroup){\n    currentGroup.addLayers([line])\n    currentGroup.fixGeometryWithOptions(1)\n  } else {\n    let Group = require('sketch/dom').Group\n    let group = new Group({\n      parent: currentParentGroup,\n      name: 'Arrows',\n      locked: true,\n      layers: [line]\n    })\n    group.moveToBack()\n    group.adjustToFit()\n  }\n}\n\nfunction addToConditionGroup(condition, x, y){ // Refactored\n  let conGroup = checkForGroup(\"Conditions\") \n  let arGroup = checkForGroup(\"Arrows\") \n  let arGroupX = arGroup != null ? arGroup.frame().x() : 0\n  let arGroupY = arGroup != null ? arGroup.frame().y() : 0\n\n  if(conGroup){\n    condition.frame.x = x - condition.frame.width / 2 - (conGroup.frame().x() - arGroupX) \n    condition.frame.y = y - condition.frame.height / 2 - (conGroup.frame().y() - arGroupY) \n    condition.parent = conGroup\n    conGroup.fixGeometryWithOptions(1)\n  } else {\n    condition.frame.x = x - condition.frame.width / 2 \n    condition.frame.y = y - condition.frame.height / 2\n    let Group = require('sketch/dom').Group\n    let group = new Group({\n      parent: currentParentGroup,\n      name: 'Conditions',\n      layers: [condition]\n    })\n    group.moveToBack()\n    group.adjustToFit()\n  }\n  return condition.id\n}\n\nfunction getConnectionsData(){ //Refactored\n  let dataArray = []\n  \n  if(pluginData){\n    for (let i = 0; i < pluginData.length; i ++) {\n      dataArray.push(pluginData[i])\n    }\n  } \n  return dataArray\n}\n\nfunction findConnectionIndex(firstObjectID, secondObjectID, data){\n  let indexArray = []  \n  firstObjectID = String(firstObjectID)\n  secondObjectID = String(secondObjectID)\n  \n  if(pluginData){\n    // If we have database, need to check for connections\n    for(let y = 0; y < data.length; y++){\n      if(firstObjectID == data[y].firstObject || firstObjectID == data[y].secondObject){\n        if(secondObjectID == null){\n          // When we need to find connection between two objects\n          if(secondObjectID == data[y].firstObject || secondObjectID == data[y].secondObject){\n            indexArray[0] = y\n          } \n        } else {\n          // When we need to find a connection for one object only\n          indexArray.push(y)\n        }\n      }\n    }\n  }\n  return indexArray\n}\n\nfunction setActiveStyleSetting(arrowStylingField){\n  let docSettings = context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey)\n  let styles = getLayerStyles(null)\n\n  if(docSettings){\n    // We have info about the settings in the current document\n    \n    if(docSettings != \"Default Style\") {\n      // if user specified own option\n      arrowStylingField.addItemWithTitle(docSettings)\n      arrowStylingField.addItemWithTitle(\"Default Style\")\n      for(let i = 0; i < styles.length; i++){\n        if(styles[i].name() != docSettings){\n          arrowStylingField.addItemWithTitle(styles[i].name())\n        }\n      }\n\n    } else {\n      // Need to show the default first\n      arrowStylingField.addItemWithTitle(\"Default Style\")\n      for(let i = 0; i < styles.length; i++){\n        arrowStylingField.addItemWithTitle(styles[i].name())\n      }\n    }\n  } else {\n    arrowStylingField.addItemWithTitle(\"Default Style\")\n    for(let i = 0; i < styles.length; i++){\n      arrowStylingField.addItemWithTitle(styles[i].name())\n    }\n  }\n}\n\nfunction setActiveTypeSetting(arrowTypeField){\n  let docTypeSettings = Settings.settingForKey(\"arrowType\")  \n\n\n  if(docTypeSettings){\n    // We have info about the settings in the current document\n    \n    if(docTypeSettings == \"Angled\"){\n      arrowTypeField.addItemWithTitle(\"Angled\")\n      arrowTypeField.lastItem().setState(1)\n      arrowTypeField.addItemWithTitle(\"Curved\")\n      arrowTypeField.lastItem().setState(0)\n      arrowTypeField.addItemWithTitle(\"Straight\")\n      arrowTypeField.lastItem().setState(0)\n    } \n\n    if(docTypeSettings == \"Curved\"){\n      arrowTypeField.addItemWithTitle(\"Curved\")\n      arrowTypeField.lastItem().setState(1)\n      arrowTypeField.addItemWithTitle(\"Straight\")\n      arrowTypeField.lastItem().setState(0)\n      arrowTypeField.addItemWithTitle(\"Angled\")\n      arrowTypeField.lastItem().setState(0)\n    } \n\n    if(docTypeSettings == \"Straight\"){\n      arrowTypeField.addItemWithTitle(\"Straight\")\n      arrowTypeField.lastItem().setState(1)\n      arrowTypeField.addItemWithTitle(\"Angled\")\n      arrowTypeField.lastItem().setState(0)\n      arrowTypeField.addItemWithTitle(\"Curved\")\n      arrowTypeField.lastItem().setState(0)\n    } \n  } else {\n    // Show default\n    arrowTypeField.addItemWithTitle(\"Angled\")\n    arrowTypeField.addItemWithTitle(\"Curved\")\n    arrowTypeField.addItemWithTitle(\"Straight\")\n  }\n\n}\n\nfunction deleteConnectionFromData(connectionIndex){ // Refactored\n  let newConnections = []\n  if(pluginData){\n    // If we have database\n    let connections = pluginData\n\n    for (let i = 0; i < connections.length; i ++) {\n      // Updating all connections without deleted one\n      if(i != connectionIndex){\n        newConnections.push(connections[i])\n      }\n    }\n  }\n  return newConnections\n}\n\nfunction deleteLine(lineID){ // refactored\n  let lineObject = document.getLayerWithID(lineID)\n  let selectedGroup\n  if(lineObject){\n    selectedGroup = lineObject.parent\n    lineObject.remove()\n    if(selectedGroup.layers.length == 0){\n      selectedGroup.remove()\n    }\n  }\n}\n\nfunction updateSpacing(sourceObjectID, childObjectID, direction){\n  let sourceObject = document.getLayerWithID(sourceObjectID)\n  let childObject = document.getLayerWithID(childObjectID)\n\n  if(Settings.settingForKey(\"arrowSpacing\") && Settings.settingForKey(\"arrowSpacing\") != 0){\n    let currentSpacing = Settings.settingForKey(\"arrowSpacing\")\n    \n    if(direction == \"Right\"){\n      childObject.frame.x = sourceObject.frame.x + sourceObject.frame.width + currentSpacing\n    }\n  \n    if(direction == \"Down\"){\n      childObject.frame.y = sourceObject.frame.y + sourceObject.frame.height + currentSpacing\n    }\n  \n    if(direction == \"Left\"){\n      childObject.frame.x = sourceObject.frame.x - childObject.frame.width - currentSpacing\n    }\n  \n    if(direction == \"Up\"){\n      childObject.frame.y = sourceObject.frame.y - childObject.frame.height - currentSpacing\n    }\n  }\n}\n\nfunction autoAlignLayer(sourceObjectID, childObjectID, direction){\n  let sourceObject = document.getLayerWithID(sourceObjectID)\n  let childObject = document.getLayerWithID(childObjectID)\n  let sourceMidY, childMidY, sourceMidX, childMidX, diff\n\n  if(Settings.settingForKey(\"autoAlign\")){\n    if(Settings.settingForKey(\"autoAlign\") == true){\n      // If user turned on Auto-Align settings\n      \n      if(direction == \"Right\" || direction == \"Left\"){\n        sourceMidY = sourceObject.frame.y + sourceObject.frame.height/2\n        childMidY = childObject.frame.y + childObject.frame.height/2\n        diff = sourceMidY - childMidY\n        if(diff > -6 && diff < 6){childObject.frame.y = childObject.frame.y + diff}\n      }\n    \n      if(direction == \"Down\" || direction == \"Up\"){\n        sourceMidX = sourceObject.frame.x + sourceObject.frame.width/2\n        childMidX = childObject.frame.x + childObject.frame.width/2\n        diff = sourceMidX - childMidX\n        if(diff > -6 && diff < 6){childObject.frame.x = childObject.frame.x + diff}\n      }\n    }\n  }\n}\n\nfunction defineSourceObject(firstObjectID, secondObjectID, direction){ //Refactored\n  let firstObject = document.getLayerWithID(firstObjectID)\n  let secondObject = document.getLayerWithID(secondObjectID)\n  let sourceObjectID\n\n  if(direction == \"Right\"){\n    if(firstObject.frame.x <= secondObject.frame.x){\n      sourceObjectID = firstObject.id\n    } else {\n      sourceObjectID = secondObject.id\n    }\n  }\n\n  if(direction == \"Down\"){\n    if(firstObject.frame.y <= secondObject.frame.y){\n      sourceObjectID = firstObject.id\n    } else {\n      sourceObjectID = secondObject.id\n    }\n  }\n\n  if(direction == \"Left\"){\n    if(firstObject.frame.x <= secondObject.frame.x){\n      sourceObjectID = secondObject.id\n    } else {\n      sourceObjectID = firstObject.id\n    }\n  }\n\n  if(direction == \"Up\"){\n    if(firstObject.frame.y <= secondObject.frame.y){\n      sourceObjectID = secondObject.id\n    } else {\n      sourceObjectID = firstObject.id\n    }\n  }\n\n  return sourceObjectID\n}\n\nfunction getSourceObjectFromSelection(selection, direction){ //Refactored\n  let sourceObjectID = selection.firstObject().objectID()\n  \n  if(direction != \"Auto\"){\n    for(let g = 0; g < selection.count(); g++) {\n      sourceObjectID = defineSourceObject(sourceObjectID, selection[g].objectID(), direction)\n    }\n  }\n \n  return sourceObjectID\n}\n\nfunction alertSetup(alert, viewWidth, viewHeight){\n  // Title\n  alert.setMessageText(\"Arrow Plugin Settings\")\n  \n  // Creating dialog buttons\n  alert.addButtonWithTitle(\"Update Settings\")\n  alert.addButtonWithTitle(\"Cancel\")\n  \n  return alert\n}\n\nfunction alertLabel(message, state, x, y, width, height){\n  let infoLabel = NSTextField.alloc().initWithFrame(NSMakeRect(x, y, width, height))\n\n  infoLabel.setStringValue(message)\n  infoLabel.setSelectable(false)\n  infoLabel.setDrawsBackground(false)\n  infoLabel.setBezeled(false)\n\n  if(state == false){\n    infoLabel.textColor = NSColor.disabledControlTextColor()\n  }\n\n  return infoLabel\n}\n\nfunction alertCheckbox(message, state, x, y, width, height){\n  let checkbox = NSButton.alloc().initWithFrame(NSMakeRect(x, y, width, height))\n\n  checkbox.setButtonType(NSSwitchButton)\n  checkbox.setBezelStyle(0)\n  checkbox.setTitle(message)\n  if(Settings.settingForKey(\"autoAlign\")){\n    let currentState = Settings.settingForKey(\"autoAlign\")  \n    checkbox.setState(currentState)\n  } else {\n    checkbox.setState(state)\n  }\n\n  return checkbox\n}\n\nfunction getLayerStyles(name) { // Refactored\n  let allStyles = docData.allLayerStyles()\n  let keyword = \"$arrow\"\n  let styles = []\n\n  for(let i = 0; i < allStyles.count(); i++){\n    if(name == null) {\n      if(allStyles[i].name().includes(keyword)){styles.push(allStyles[i])}\n    } else {\n      if(allStyles[i].name() == name){styles.push(allStyles[i])}\n    }\n  }\n\treturn styles\n}\n\nfunction start(context, direction, isCondition){\n  let selection = context.selection\n\n  if(selection.count() > 1 && selection[0].class() != \"MSArtboardGroup\"){\n    // Need to find source object by ID first\n    let sourceObjectID = getSourceObjectFromSelection(selection, direction)\n    let currentConnectionsData = newConnectionsData // Need to refactor\n\n    for(let g = 0; g < selection.count(); g++) {\n      if(selection[g].objectID() != sourceObjectID){\n        // Then need to create or update connection arrow with each selection\n        let connectionIndex = findConnectionIndex(sourceObjectID, selection[g].objectID(), currentConnectionsData)\n        \n        if(connectionIndex.length == 0){\n          // There is no connection with this two objects in our database\n          createArrow(sourceObjectID, selection[g].objectID(), null, null, direction, null, isCondition)\n          sketch.UI.message(\"New connection is created 🚀\")\n        } else {\n          // Need to remake the arrow condition\n          updateArrow(sourceObjectID, selection[g].objectID(), null, null, direction, currentConnectionsData[connectionIndex].line, currentConnectionsData[connectionIndex].condition, isCondition, connectionIndex)\n          sketch.UI.message(\"Current connection is updated 🤘\")\n        }\n      }\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n  } else {\n    // When user didn't select anything\n    sketch.UI.message(\"Please select more than two layers. Artboards are coming soon 🥳\")\n  }\n}\n\nfunction addCondition(keyword, x, y){ // Refactored\n  let libraries = sketch.getLibraries()\n  let libraryObject, symbolReferences, symbol\n\n  for(let g = 0; g < libraries.length; g++) {\n    symbolReferences = libraries[g].getImportableSymbolReferencesForDocument(document)\n    for(let i = 0; i < symbolReferences.length; i++) {\n      if(symbolReferences[i].name.includes(keyword)){\n        libraryObject = symbolReferences[i]\n      }\n    }\n  }\n\n  if(libraryObject == null){\n    symbol = null\n    UI.alert('Condition symbol is not found', 'If you would like to add arrows with specific conditions, you need to specify them in your libraries. You can download the library that works well with the plugin by going into Plugins -> Connection Arrows -> Get Free Library. Conditions are taken from the library based on their names. Make sure to name symbol as \"#condition\" so it will be added here')\n  } else {\n    let symbolMaster = libraryObject.import()\n    symbol = symbolMaster.createNewInstance()\n    symbol = addToConditionGroup(symbol, x, y)\n  }\n\n  return symbol\n}\n\nfunction updateCondition(conditionID, x, y){ // Refactored\n  let condition = document.getLayerWithID(conditionID)\n  // log (condition)\n  let conGroup = checkForGroup(\"Conditions\") \n  let arGroup = checkForGroup(\"Arrows\") \n  let arGroupX = arGroup != null ? arGroup.frame().x() : 0\n  let arGroupY = arGroup != null ? arGroup.frame().y() : 0\n\n  if(conGroup){\n    condition.frame.x = x - condition.frame.width / 2 - (conGroup.frame().x() - arGroupX) \n    condition.frame.y = y - condition.frame.height / 2 - (conGroup.frame().y() - arGroupY) \n    conGroup.fixGeometryWithOptions(1)\n  } else {\n    condition.frame.x = x - condition.frame.width / 2 \n    condition.frame.y = y - condition.frame.height / 2\n  }\n  return condition.id\n}\n\nfunction getConnectionPos(firstObject, secondObject, direction){ // Refactored\n\n  let firstObjectAbsPos = firstObject.frame.changeBasis({from: firstObject.parent, to: currentParentGroup})\n  let secondObjectAbsPos = secondObject.frame.changeBasis({from: secondObject.parent, to: currentParentGroup})\n  let currentGroup = checkForGroup(\"Arrows\") \n  let diffX, diffY\n\n  if(currentGroup){\n    diffX = currentGroup.frame().x()\n    diffY = currentGroup.frame().y()\n  } else {\n    diffX = 0\n    diffY = 0\n  }\n\n  let connectionPos = {\n    firstLayerPosX: null, \n    firstLayerPosY: null, \n    secondLayerPosX: null, \n    secondLayerPosY: null, \n    middlePosX: null, \n    middlePosY: null\n  }\n\n  // Getting all the positions\n  if(direction == \"Up\"){\n    // First Layer Position Start Point Position\n    connectionPos.firstLayerPosX = firstObjectAbsPos.x+firstObjectAbsPos.width/2-diffX\n    connectionPos.firstLayerPosY = firstObjectAbsPos.y-diffY\n\n    // Second Layer Position End Point Position\n    connectionPos.secondLayerPosX = secondObjectAbsPos.x+secondObjectAbsPos.width/2-diffX\n    connectionPos.secondLayerPosY = secondObjectAbsPos.y+secondObjectAbsPos.height-diffY\n\n    // Middle Points\n    connectionPos.middlePosX = (connectionPos.firstLayerPosX + connectionPos.secondLayerPosX)/2\n    connectionPos.middlePosY = (connectionPos.firstLayerPosY + connectionPos.secondLayerPosY)/2\n  }\n\n  if(direction == \"Right\"){\n    // First Layer Position Start Point Position\n    connectionPos.firstLayerPosX = firstObjectAbsPos.x+firstObjectAbsPos.width-diffX\n    connectionPos.firstLayerPosY = firstObjectAbsPos.y+firstObjectAbsPos.height/2-diffY\n\n    // Second Layer Position End Point Position\n    connectionPos.secondLayerPosX = secondObjectAbsPos.x-diffX\n    connectionPos.secondLayerPosY = secondObjectAbsPos.y+secondObjectAbsPos.height/2-diffY\n    \n    // Middle Points\n    connectionPos.middlePosX = (connectionPos.firstLayerPosX + connectionPos.secondLayerPosX)/2\n    connectionPos.middlePosY = (connectionPos.firstLayerPosY + connectionPos.secondLayerPosY)/2\n  }\n\n  if(direction == \"Down\"){\n    // First Layer Position Start Point Position\n    connectionPos.firstLayerPosX = firstObjectAbsPos.x+firstObjectAbsPos.width/2-diffX\n    connectionPos.firstLayerPosY = firstObjectAbsPos.y+firstObjectAbsPos.height-diffY\n\n    // Second Layer Position End Point Position\n    connectionPos.secondLayerPosX = secondObjectAbsPos.x+secondObjectAbsPos.width/2-diffX\n    connectionPos.secondLayerPosY = secondObjectAbsPos.y-diffY\n\n    // Middle Points\n    connectionPos.middlePosX = (connectionPos.firstLayerPosX + connectionPos.secondLayerPosX)/2\n    connectionPos.middlePosY = (connectionPos.firstLayerPosY + connectionPos.secondLayerPosY)/2\n  }\n\n  if(direction == \"Left\"){\n    // First Layer Position Start Point Position\n    connectionPos.firstLayerPosX = firstObjectAbsPos.x-diffX\n    connectionPos.firstLayerPosY = firstObjectAbsPos.y+firstObjectAbsPos.height/2-diffY\n\n    // Second Layer Position End Point Position\n    connectionPos.secondLayerPosX = secondObjectAbsPos.x+secondObjectAbsPos.width-diffX\n    connectionPos.secondLayerPosY = secondObjectAbsPos.y+secondObjectAbsPos.height/2-diffY\n\n    // Middle Points\n    connectionPos.middlePosX = (connectionPos.firstLayerPosX + connectionPos.secondLayerPosX)/2\n    connectionPos.middlePosY = (connectionPos.firstLayerPosY + connectionPos.secondLayerPosY)/2\n  }\n\n  return connectionPos\n}\n\nfunction drawStraightLine(firstLayerPosX, firstLayerPosY, secondLayerPosX, secondLayerPosY, direction){ // Refactored\n  let path = NSBezierPath.bezierPath()\n  \n  if(direction == \"Up\"){\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n  }\n\n  if(direction == \"Right\"){\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n  }\n\n  if(direction == \"Down\"){\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n  }\n\n  if(direction == \"Left\"){\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n  }\n\n  let line = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n  line.setName(\"Straight Arrow\")\n\n  return line\n}\n\nfunction drawAngledLine(firstLayerPosX, firstLayerPosY, middlePosX, middlePosY, secondLayerPosX, secondLayerPosY, direction){ // Refactored\n  let path = NSBezierPath.bezierPath()\n\n  if(direction == \"Up\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX, firstLayerPosY))\n    path.lineToPoint(NSMakePoint(firstLayerPosX, middlePosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX, middlePosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX, secondLayerPosY))\n  }\n\n  if(direction == \"Right\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX, firstLayerPosY))\n    path.lineToPoint(NSMakePoint(middlePosX, firstLayerPosY))\n    path.lineToPoint(NSMakePoint(middlePosX, secondLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX, secondLayerPosY))\n  }\n\n  if(direction == \"Down\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX, firstLayerPosY))\n    path.lineToPoint(NSMakePoint(firstLayerPosX, middlePosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX, middlePosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX, secondLayerPosY))\n  }\n\n  if(direction == \"Left\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX, firstLayerPosY))\n    path.lineToPoint(NSMakePoint(middlePosX, firstLayerPosY))\n    path.lineToPoint(NSMakePoint(middlePosX, secondLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX, secondLayerPosY))\n  }\n\n  let line = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n  let points = line.layers().firstObject().points()\n  points[1].cornerRadius = 20\n  points[2].cornerRadius = 20\n  line.setName(\"Angled Arrow\")\n\n  return line\n}\n\nfunction drawCurvedLine(firstLayerPosX, firstLayerPosY, secondLayerPosX, secondLayerPosY, direction){ // Refactored\n  let path = NSBezierPath.bezierPath()\n  let line\n\n  if(direction == \"Up\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n\n    // Painting the line\n    line = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n    let points = line.layers().firstObject().points()\n\n    points[0].curveMode = points[1].curveMode = 4\n    points[0].hasCurveFrom = points[1].hasCurveTo = true\n\n    if(firstLayerPosX<secondLayerPosX){\n      points[0].curveFrom = {x: 0, y: 0.5}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 1,y: 0.5}\n    } else {\n      points[0].curveFrom = {x: 1, y: 0.5}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 0,y: 0.5}\n    }\n  }\n\n  if(direction == \"Right\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n\n    // Painting the line\n    line = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n    let points = line.layers().firstObject().points()\n\n    points[0].curveMode = points[1].curveMode = 4\n    points[0].hasCurveFrom = points[1].hasCurveTo = true\n\n    if(firstLayerPosY<secondLayerPosY){\n      points[0].curveFrom = {x: 0.5, y: 0}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 0.5,y: 1}\n    } else {\n      points[0].curveFrom = {x: 0.5, y: 1}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 0.5,y: 0}\n    }\n  }\n\n  if(direction == \"Down\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n\n    // Painting the line\n    line = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n    let points = line.layers().firstObject().points()\n\n    points[0].curveMode = points[1].curveMode = 4\n    points[0].hasCurveFrom = points[1].hasCurveTo = true\n\n    if(firstLayerPosX<secondLayerPosX){\n      points[0].curveFrom = {x: 0, y: 0.5}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 1,y: 0.5}\n    } else {\n      points[0].curveFrom = {x: 1, y: 0.5}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 0,y: 0.5}\n    }\n  }\n\n  if(direction == \"Left\"){\n    // Connecting points\n    path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n    path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n\n    // Painting the line\n    line = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n    let points = line.layers().firstObject().points()\n\n    points[0].curveMode = points[1].curveMode = 4\n    points[0].hasCurveFrom = points[1].hasCurveTo = true\n\n    if(firstLayerPosY<secondLayerPosY){\n      points[0].curveFrom = {x: 0.5, y: 0}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 0.5,y: 1}\n    } else {\n      points[0].curveFrom = {x: 0.5, y: 1}\n      points[0].curveTo = {x: -0.5,y:1}\n\n      points[1].curveFrom = {x: 1,y: 1}\n      points[1].curveTo = {x: 0.5,y: 0}\n    }\n  }\n\n  // Providing Settings for the arrow\n  line.setName(\"Curved Arrow\")\n\n  return line\n}\n\nfunction styleLine(line, style){ // Refactored\n  let localStyle\n  \n  if(style != null){ \n    // For updates\n    if(getLayerStyles(style) != null && style != \"Default Style\"){\n      // If style is specified\n      localStyle = style\n      let ownStyle = getLayerStyles(style)\n      line.sharedStyle = ownStyle[0]\n    } else {\n      // if there is no specific style\n      localStyle = \"Default Style\"\n      let border = line.style().addStylePartOfType(1)\n      border.color = MSColor.colorWithRGBADictionary({r: 0.89, g: 0.89, b: 0.89, a: 1})\n      border.thickness = 2\n      line.style().endMarkerType = 2\n    }\n  } else {\n    // For creating new\n    if(context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey) != null && context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey) != \"Default Style\"){\n      // we have settins almost all the time and it's not default\n      localStyle = getLayerStyles(context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey))\n      line.sharedStyle = localStyle[0]\n      localStyle = localStyle[0].name()\n    } else {\n      localStyle = \"Default Style\"\n      let border = line.style().addStylePartOfType(1)\n      border.color = MSColor.colorWithRGBADictionary({r: 0.89, g: 0.89, b: 0.89, a: 1})\n      border.thickness = 2\n      line.style().endMarkerType = 2\n    } \n  }\n\n  return localStyle\n}\n\n// const track = require(\"sketch-module-google-analytics\")\n// track(\"UA-138226597-1\", \"event\", {\n//   ec: \"command\", \n//   ea: \"start\", \n//   ev: \"my-command\"\n// });\n\n\n\n\n\n","module.exports = require(\"sketch\");","module.exports = require(\"sketch/dom\");","module.exports = require(\"sketch/settings\");","module.exports = require(\"sketch/ui\");"],"sourceRoot":""}