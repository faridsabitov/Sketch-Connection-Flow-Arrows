{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./src/script.js","webpack://exports/external \"sketch\"","webpack://exports/external \"sketch/dom\"","webpack://exports/external \"sketch/settings\"","webpack://exports/external \"sketch/ui\""],"names":["UI","require","SharedStyle","pluginKey","document","sketch","fromNative","context","docData","documentData","pluginData","command","valueForKey_onLayer_forPluginIdentifier","currentParentGroup","currentPage","currentArtboard","newConnectionsData","getConnectionsData","Settings","arrowDirectionSetting","settingForKey","createDefaultArrow","start","createAutoArrow","createRightArrow","createDownArrow","createLeftArrow","createUpArrow","createRightArrowWithCondition","createDownArrowWithCondition","createLeftArrowWithCondition","createUpArrowWithCondition","updateSelectedArrows","selection","count","currentConnectionsData","g","objectID","connectionIndex","findConnectionData","updateArrow","firstObject","secondObject","style","type","direction","line","condition","message","setValue_forKey_onLayer_forPluginIdentifier","updateArtboardArrows","connections","firstObjectArtboard","secondObjectArtboard","length","updateArrowsCounter","i","getLayerWithID","sketchObject","parentArtboard","class","push","updateAllArrows","deleteAllArrows","deleteLine","deleteArtboardArrows","deleteConnectionFromData","deleteSelectedArrows","settings","alert","COSAlertWindow","new","viewWidth","viewHeight","alertSetup","view","NSView","alloc","initWithFrame","NSMakeRect","addAccessoryView","arrowStyleLabel","alertLabel","addSubview","arrowStylingField","NSPopUpButton","setActiveStyleSetting","arrowStyleInfoLabel","arrowTypeLabel","arrowTypeField","setActiveTypeSetting","arrowTypeInfoLabel","arrowSpacingLabel","arrowSpacingPxLabel","arrowSpacingField","NSTextField","formatter","NSNumberFormatter","init","autorelease","setStringValue","String","setFormatter","arrowSpacingStepper","NSStepper","setMaxValue","setMinValue","setValueWraps","setAutorepeat","setCOSJSTargetFunction","sender","value","integerValue","arrowSpacingInfoLabel","otherSettingsLabel","checkbox","alertCheckbox","autoAlignInfoLabel","pluginInfoLabel","modalResponse","runModal","NSAlertFirstButtonReturn","views","subviews","title","setSettingForKey","intValue","state","onLayersMoved","action","actionContext","panel","ControlBar","NSPanel","setStyleMask","NSTitledWindowMask","NSFullSizeContentViewWindowMask","setTitleVisibility","NSWindowTitleHidden","setTitlebarAppearsTransparent","setFrame_display","setMovableByWindowBackground","setHasShadow","setLevel","NSFloatingWindowLevel","center","makeKeyAndOrderFront","nil","firstObjectID","secondObjectID","lineID","conditionID","createArrow","localDirection","localStyle","localType","getDirection","getLayerStyles","updateSpacing","autoAlignLayer","currentArrowsGroup","checkForGroup","drawLine","log","addToArrowsGroup","connection","groupName","currentGroup","layers","name","refactorLines","firstObjectMidX","frame","x","width","firstObjectMidY","y","height","secondObjectMidX","secondObjectMidY","diffX","diffY","absDiffX","Math","abs","absDiffY","firstLayerPosX","firstLayerPosY","secondLayerPosX","secondLayerPosY","middlePosX","middlePosY","firstObjectAbsPos","changeBasis","from","parent","to","secondObjectAbsPos","path","NSBezierPath","bezierPath","moveToPoint","NSMakePoint","lineToPoint","MSShapeGroup","layerWithPath","MSPath","pathWithBezierPath","points","cornerRadius","setName","curveMode","hasCurveFrom","hasCurveTo","curveFrom","curveTo","addCondition","border","addStylePartOfType","color","MSColor","colorWithRGBADictionary","r","b","a","thickness","endMarkerType","sharedStyle","ownStyle","addLayers","fixGeometryWithOptions","Group","group","locked","moveToBack","dataArray","pluginDataConnections","data","arrayNumber","setActiveDirectionSetting","arrowDirectionField","currentDirection","addItemWithTitle","lastItem","setState","docSettings","styles","docTypeSettings","newConnections","lineObject","selectedGroup","remove","sourceObjectID","childObjectID","sourceObject","childObject","currentSpacing","sourceMidY","childMidY","sourceMidX","childMidX","diff","defineSourceObject","id","getSourceObjectFromSelection","confirmationAlert","setMessageText","addButtonWithTitle","infoLabel","setSelectable","setDrawsBackground","setBezeled","textColor","NSColor","disabledControlTextColor","NSButton","setButtonType","NSSwitchButton","setBezelStyle","setTitle","currentState","allStyles","allLayerStyles","keyword","includes","getConditionID","libraries","getLibraries","symbolReferences","getImportableSymbolReferencesForDocument","conditionObject","symbolMaster","import","instance","createNewInstance"],"mappings":"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","file":"script.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/script.js\");\n","import sketch from 'sketch'\n// const { toArray } = require('util')\n\n//\n//  Variables\n//\n\nlet UI = require('sketch/ui') \nvar SharedStyle = require('sketch/dom').SharedStyle\n\nconst pluginKey = \"flowArrows\"\nconst document = sketch.fromNative(context.document)\nlet docData = context.document.documentData()\nlet pluginData = context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowConnections\", docData, pluginKey) // TODO: Need to refactor\nlet currentParentGroup = docData.currentPage().currentArtboard() || docData.currentPage() // TODO: Might be a problem for multiple artboards\nlet newConnectionsData = getConnectionsData()\n\n// Settings\nvar Settings = require('sketch/settings')\nlet arrowDirectionSetting\n\nif(Settings.settingForKey(\"arrowDirection\")) {\n  arrowDirectionSetting = Settings.settingForKey('arrowDirection')\n} else {\n  arrowDirectionSetting = \"Auto\"\n}\n  \n//\n//  Create Connection Function\n//\n\nexport default function(context) {}\nexport function createDefaultArrow(context){start(context, null)}\nexport function createAutoArrow(context){start(context, \"Auto\")}\nexport function createRightArrow(context){start(context, \"Right\", false)}\nexport function createDownArrow(context){start(context, \"Down\", false)}\nexport function createLeftArrow(context){start(context, \"Left\", false)}\nexport function createUpArrow(context){start(context, \"Up\", false)}\n\nexport function createRightArrowWithCondition(context){start(context, \"Right\", true)}\nexport function createDownArrowWithCondition(context){start(context, \"Down\", true)}\nexport function createLeftArrowWithCondition(context){start(context, \"Left\", true)}\nexport function createUpArrowWithCondition(context){start(context, \"Up\", true)}\n//\n// Plugin Commands\n//\n\nexport function updateSelectedArrows(context) {\n\n  let selection = context.selection\n\n  if(selection.count() > 1){\n    // Need to find source object by ID first\n    // let sourceObjectID = getSourceObjectFromSelection(selection)\n    let currentConnectionsData = newConnectionsData\n\n    for(let g = 0; g < selection.count(); g++) {\n      if(selection[g].objectID() != selection[0].objectID()){\n        // Then need to create or update connection arrow with each selection\n        let connectionIndex = findConnectionData(selection[0].objectID(), selection[g].objectID(), currentConnectionsData)\n\n        if(connectionIndex != null){\n          updateArrow(currentConnectionsData[connectionIndex].firstObject, currentConnectionsData[connectionIndex].secondObject, currentConnectionsData[connectionIndex].style, currentConnectionsData[connectionIndex].type, currentConnectionsData[connectionIndex].direction, currentConnectionsData[connectionIndex].line, currentConnectionsData[connectionIndex].condition, connectionIndex)\n          sketch.UI.message(\"Current connection is updated \")\n        } else {\n          sketch.UI.message(\"There is no connection between selected layers on the plugin data\")\n        }\n      }\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n  } else {\n    // When user didn't select anything\n    sketch.UI.message(\"Please select more than two layers\")\n  }\n}\n\nexport function updateArtboardArrows(context) {\n  // TODO: Need to show amount of updated arrows and deleted ones\n  let selection = context.selection\n  let connections = getConnectionsData()\n  let firstObjectArtboard\n  let secondObjectArtboard\n  \n  if(connections.length > 0){\n    // We have connections in database\n    const updateArrowsCounter = connections.length\n    for (let i = 0; i < updateArrowsCounter; i ++) {\n      // Need to check if the element is selected globally or from the artboard\n      firstObjectArtboard = document.getLayerWithID(connections[i].firstObject)\n      firstObjectArtboard = firstObjectArtboard.sketchObject.parentArtboard().objectID()\n\n      secondObjectArtboard = document.getLayerWithID(connections[i].secondObject)\n      secondObjectArtboard = secondObjectArtboard.sketchObject.parentArtboard().objectID()\n\n      if(selection.count() == 1 && selection[0].class() == \"MSArtboardGroup\"){\n        // Need to go through each connection and update arrow position for specific artboard\n        \n        if (firstObjectArtboard == selection[0].objectID()){\n          if (secondObjectArtboard == selection[0].objectID()){\n            updateArrow(connections[i].firstObject, connections[i].secondObject, connections[i].style, connections[i].type, connections[i].direction, connections[i].line, connections[i].condition, i)\n          } else {newConnectionsData.push(connections[i])}\n        } else {\n          // If not just saving it\n          newConnectionsData.push(connections[i])\n        }\n      }\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n    sketch.UI.message(\"All arrows are updated \")\n  } else {\n    // We don't have any connections to update\n    sketch.UI.message(\"There is nothing to update\")\n  }\n}\n\nexport function updateAllArrows(context) { // TODO\n  // TODO: Need to show amount of updated arrows and deleted ones\n  let currentConnectionsData = newConnectionsData\n  if(currentConnectionsData.length > 0){\n    // We have connections in database\n    const updateArrowsCounter = currentConnectionsData.length\n    for (let i = 0; i < updateArrowsCounter; i ++) {\n      // Need to go through each connection and update arrow position without artboards\n      // Need to check if current object don't have the parrent\n      updateArrow(currentConnectionsData[i].firstObject, currentConnectionsData[i].secondObject, currentConnectionsData[i].style, currentConnectionsData[i].type, currentConnectionsData[i].direction, currentConnectionsData[i].line, currentConnectionsData[i].condition, i)\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n    sketch.UI.message(\"All arrows are updated \")\n  } else {\n    // We don't have any connections to update\n    sketch.UI.message(\"There is nothing to update\")\n  }\n}\n\nexport function deleteAllArrows(context) {\n\n  if(newConnectionsData.length > 0){\n    // We have connections in database\n    for (let i = 0; i < newConnectionsData.length; i ++) {\n      // Need to go through each connection and update arrow position\n      deleteLine(newConnectionsData[i].line)\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(null, \"arrowConnections\", docData, pluginKey)\n    sketch.UI.message(\"All arrows are deleted\")\n  } else {\n    // We don't have any connections to update\n    sketch.UI.message(\"There is nothing to delete\")\n  }\n}\n\nexport function deleteArtboardArrows(context) {\n  let selection = context.selection\n  let firstObject, secondObject\n\n  // Need to delete all the arrows only from selected artboard\n  if(selection.count() == 1 && selection[0].class() == \"MSArtboardGroup\"){\n    let connections = getConnectionsData()\n    \n    if(connections.length > 0){\n      // We have connections in database\n      const updateArrowsCounter = connections.length\n      for (let i = 0; i < updateArrowsCounter; i ++) {\n        // Need to go through each connection and check if it placed on selected artboard\n        firstObject = document.getLayerWithID(connections[i].firstObject)\n        secondObject = document.getLayerWithID(connections[i].secondObject)\n        if (firstObject.sketchObject.parentArtboard().objectID() == selection[0].objectID()){\n          if (secondObject.sketchObject.parentArtboard().objectID() == selection[0].objectID()){\n            deleteLine(connections[i].line)\n            newConnectionsData = deleteConnectionFromData(i)\n          }\n        }\n      }\n      context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n      sketch.UI.message(\"All arrows from selected artboard are deleted\")\n    } else {\n      // We don't have any connections to update\n      sketch.UI.message(\"There is nothing to delete\")\n    }\n  } else {\n    sketch.UI.message(\"Please select one artboard\")\n  }\n}\n\nexport function deleteSelectedArrows(context) {\n  let selection = context.selection\n  let firstObject, secondObject\n\n  // Need to delete all the arrows only from selected artboard\n  if(selection.count() == 2){\n\n    for(let g = 0; g < selection.count(); g++) {\n\n      if(selection[g].objectID() != selection[0].objectID()){ // It will never check 3rd connection\n        let connections = getConnectionsData()\n        \n        let connectionIndex = findConnectionData(selection[0].objectID(), selection[g].objectID(), connections)\n        \n        if(connectionIndex != null){\n          // We have connections in database\n          deleteLine(connections[connectionIndex].line)\n          newConnectionsData = deleteConnectionFromData(connectionIndex)\n          const updateArrowsCounter = connections.length\n          for (let i = 0; i < updateArrowsCounter; i ++) {\n            // Need to go through each connection and check if it placed on selected artboard\n            firstObject = document.getLayerWithID(connections[i].firstObject)\n            secondObject = document.getLayerWithID(connections[i].secondObject)\n            if(firstObject.sketchObject.parentArtboard().objectID() == selection[0].objectID()){\n              if(secondObject.sketchObject.parentArtboard().objectID() == selection[0].objectID()){\n                deleteLine(connections[i].line)\n                newConnectionsData = deleteConnectionFromData(i)\n              }\n            }\n          }\n          context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n          sketch.UI.message(\"All arrows from selected layers are deleted \")\n        }\n      }\n    }\n  } else {\n    sketch.UI.message(\"Select two layers, please \")\n  }\n}\n\nexport function settings(context) {\n  let alert = COSAlertWindow.new()\n  const viewWidth = 300\n  const viewHeight = 450\n  \n  // Alert window settings\n  alert = alertSetup(alert, viewWidth, viewHeight)\n  let view = NSView.alloc().initWithFrame(NSMakeRect(0, 0, viewWidth, viewHeight))\n  alert.addAccessoryView(view)\n\n  // Label: Arrow Style\n  let arrowStyleLabel = alertLabel(\"Arrow Style\", true, -1, viewHeight-40, 280, 40)\n  view.addSubview(arrowStyleLabel)\n\n  // Select: Arrow Style\n  let arrowStylingField = NSPopUpButton.alloc().initWithFrame(NSMakeRect(-2, viewHeight - 40, 300, 20));\n  setActiveStyleSetting(arrowStylingField)\n  view.addSubview(arrowStylingField)\n\n  // Label: Arrow Style Info\n  let arrowStyleInfoLabel = alertLabel(\"Add layer style to your document that will contain $arrow name and you will be able to specify it here \", false, -1, viewHeight-80, 300, 40)\n  view.addSubview(arrowStyleInfoLabel)\n\n\n  // Label: Arrow Type\n  let arrowTypeLabel = alertLabel(\"Arrow Type\", true, -1, viewHeight-130, 280, 40)\n  view.addSubview(arrowTypeLabel)\n\n  // Select: Arrow Type\n  let arrowTypeField = NSPopUpButton.alloc().initWithFrame(NSMakeRect(-2, viewHeight - 130, 300, 20));\n  setActiveTypeSetting(arrowTypeField)\n  view.addSubview(arrowTypeField)\n\n  // Label: Arrow Type Info\n  let arrowTypeInfoLabel = alertLabel(\"Select one of the arrow types. Angled is used by default\", false, -1, viewHeight-170, 300, 40)\n  view.addSubview(arrowTypeInfoLabel)\n\n\n  // Label: Arrow Spacing\n  let arrowSpacingLabel = alertLabel(\"Arrow Spacing\", true, -1, viewHeight - 200, 330, 20)\n  view.addSubview(arrowSpacingLabel)\n\n  // Label: Arrow Spacing PX\n  let arrowSpacingPxLabel = alertLabel(\"px\", true, 90, viewHeight - 220, 330, 20)\n  view.addSubview(arrowSpacingPxLabel)\n\n  // Input: Arrow Spacing\n  let arrowSpacingField = NSTextField.alloc().initWithFrame(NSMakeRect(-2, viewHeight - 220, 80, 20))\n  var formatter = NSNumberFormatter.alloc().init().autorelease()\n  arrowSpacingField.setStringValue(String(Settings.settingForKey(\"arrowSpacing\")))\n  arrowSpacingField.setFormatter(formatter)\n  view.addSubview(arrowSpacingField)\n\n  // Stepper: Arrow Spacing\n  let arrowSpacingStepper = NSStepper.alloc().initWithFrame(NSMakeRect(70, viewHeight - 220, 20, 20));\n  arrowSpacingStepper.setMaxValue(1000)\n  arrowSpacingStepper.setMinValue(0)\n  arrowSpacingStepper.setValueWraps(false)\n  arrowSpacingStepper.setAutorepeat(true)\n  arrowSpacingStepper.setCOSJSTargetFunction(function(sender){\n    var value = 0 + sender.integerValue()\n    arrowSpacingField.setStringValue(String(value))\n  })\n  \n  view.addSubview(arrowSpacingStepper)\n  // view.addSubview(formatter)\n  \n  // Label: Auto Spacing Info\n  let arrowSpacingInfoLabel = alertLabel(\"The second layer will be moved closer based on the value provided here. Keep it 0 if you don't want to have auto spacing feature \", false, -1, viewHeight-285, 300, 60)\n  view.addSubview(arrowSpacingInfoLabel)\n\n  // Label: Other Settings\n  let otherSettingsLabel = alertLabel(\"Other Settings\", true, -1, viewHeight-330, 280, 40)\n  view.addSubview(otherSettingsLabel)\n\n  // Checkbox: Auto-Align\n  let checkbox = alertCheckbox(\"Second layer auto-align\", false, -1, viewHeight-340, 260, 40)\n  view.addSubview(checkbox)\n\n  // Label: Auto-Align Info\n  let autoAlignInfoLabel = alertLabel(\"Align the second layer for 5px misalignment with the first one\", false, -1, viewHeight-370, 280, 40)\n  view.addSubview(autoAlignInfoLabel)\n\n  // Label: Plugin Info\n  let pluginInfoLabel = alertLabel(\"Made by @faridSabitov with the support of EPAM.com \", true, -1, viewHeight-420, 280, 40)\n  view.addSubview(pluginInfoLabel)\n\n\n  // Need to check if style is still available\n\n  // Show modal and get the results\n  let modalResponse = alert.runModal()\n\n  if(modalResponse == NSAlertFirstButtonReturn){\n    // When user clicks on \"Update Settings\"\n    // Need to save all this results into the Plugin Settings\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(alert.views()[0].subviews()[1].title(), \"arrowStyle\", docData, pluginKey)\n    Settings.setSettingForKey(\"arrowType\", alert.views()[0].subviews()[4].title())\n    Settings.setSettingForKey(\"arrowSpacing\", alert.views()[0].subviews()[8].intValue())\n    Settings.setSettingForKey(\"autoAlign\", alert.views()[0].subviews()[12].state())\n    UI.message(\"Settings are updated \")\n  }\n}\n\nexport function onLayersMoved(context) {\n  sketch.UI.message(\"Please select more than two layers\")\n  const action = context.actionContext  \n}\n\nexport function panel(context) {\n  let ControlBar\n  ControlBar = NSPanel.alloc().init();\n  ControlBar.setStyleMask(NSTitledWindowMask + NSFullSizeContentViewWindowMask);\n  // ControlBar.setBackgroundColor(NSColor.colorWithRed_green_blue_alpha(0.99, 0.99, 0.99, 1));\n  ControlBar.setTitleVisibility(NSWindowTitleHidden);\n  ControlBar.setTitlebarAppearsTransparent(true);\n  ControlBar.setFrame_display(NSMakeRect(0, 0, 720, 50), false);\n  ControlBar.setMovableByWindowBackground(true);\n  ControlBar.setHasShadow(true);\n  ControlBar.setLevel(NSFloatingWindowLevel);\n\n  // contentView.addSubview(closeButton)\n  ControlBar.center();\n  ControlBar.makeKeyAndOrderFront(nil);\n\n//   getImage = function(size, name){\n//     var isRetinaDisplay = (NSScreen.mainScreen().backingScaleFactor() > 1)? true: false;\n//         suffix = (isRetinaDisplay)? \"@2x\": \"\",\n//         imageURL = NSURL.fileURLWithPath(self.pluginResources + \"/icons/\" + name + suffix + \".png\"),\n//         image = NSImage.alloc().initWithContentsOfURL(imageURL);\n//     return image\n// },\n// addButton = function(rect, name, callAction){\n//     var button = NSButton.alloc().initWithFrame(rect),\n//         image = getImage(rect.size, name);\n\n//     button.setImage(image);\n//     button.setBordered(false);\n//     button.sizeToFit();\n//     button.setButtonType(NSMomentaryChangeButton);\n//     button.setCOSJSTargetFunction(callAction);\n//     button.setAction(\"callAction:\");\n//     return button;\n// },\n// addImage = function(rect, name){\n//     var view = NSImageView.alloc().initWithFrame(rect),\n//         image = getImage(rect.size, name);\n//     view.setImage(image);\n//     return view;\n// },\n\n// closeButton = addButton( NSMakeRect(20, 10, 30, 30), \"close-control\",\n//     function(sender){\n//         coscript.setShouldKeepAround(false);\n//         threadDictionary.removeObjectForKey(identifier);\n//         ControlBar.close();\n// }),\n\n\n\n}\n\n//\n// Functions\n//\n\nfunction updateArrow(firstObjectID, secondObjectID, style, type, direction, lineID, conditionID, connectionIndex) {\n  // There might be a situation, when user deleted current group or current group stays on another artboard => In that case need to create another group\n  // Need to check if we have the layers with such IDs\n  let firstObject = document.getLayerWithID(firstObjectID)\n  let secondObject = document.getLayerWithID(secondObjectID)\n  \n  // Need to delete data first, because we will have a new line\n  deleteLine(lineID)\n  newConnectionsData = deleteConnectionFromData(connectionIndex)\n\n  if(firstObject && secondObject){\n    // If we have all the objects, we can recreate the line\n    createArrow(firstObjectID, secondObjectID, style, type, direction, conditionID)\n  } \n}\n\nfunction createArrow(firstObjectID, secondObjectID, style, type, direction, condition) {\n  // Process of creating new connection  \n  let localDirection, localStyle, localType\n  if(direction == \"Auto\"){\n    // If direction is auto, we need to specify direction ourselves\n    localDirection = getDirection(firstObjectID, secondObjectID)\n  } else {\n    localDirection = direction\n  }\n\n  if(type == null){\n    localType = Settings.settingForKey(\"arrowType\")  \n  } else {\n    localType = type\n  }\n  \n  // log(context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey))\n  localStyle = getLayerStyles(context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey))\n  \n  if(style != null){\n    // if we updating connection with previously created objects\n    if(getLayerStyles(style) != null && style != \"Default Style\"){\n      localStyle = style\n    } else {\n      localStyle = \"Default Style\"\n    }\n  } else {\n    // We don't have any data from the plugin data\n    if(context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey)){\n      localStyle = context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey)\n    } else {\n      localStyle = \"Default Style\"\n    }\n    \n  }\n  \n  \n  updateSpacing(firstObjectID, secondObjectID, localDirection)\n  autoAlignLayer(firstObjectID, secondObjectID, localDirection)\n  let currentArrowsGroup = checkForGroup(\"Arrows\")\n  let line = drawLine(firstObjectID, secondObjectID, localStyle, localType, localDirection, currentArrowsGroup, condition)\n  log(line)\n  addToArrowsGroup(line, currentArrowsGroup)\n\n\n  // if(localStyle != \"Default Style\"){\n  //   localStyle = localStyle[0].name()\n  // }\n\n  // Storage for current connection\n  let connection = {\n    firstObject : firstObjectID,\n    secondObject : secondObjectID,\n    style : localStyle,\n    condition : conditionID,\n    type : localType,\n    direction: localDirection,\n    line : line.objectID()\n  }\n  // Need to save this data to the global array\n  newConnectionsData.push(connection)\n}\n\nfunction checkForGroup(groupName) {\n  let currentGroup = null\n  // Checking all the groups that we have\n  for(let i = 0; i < currentParentGroup.layers().count(); i++){\n    if(currentParentGroup.layers()[i].name() == groupName) {\n      // If we already have \"Arrow\" group we need to save it's folder\n      currentGroup = currentParentGroup.layers()[i]\n      refactorLines(currentGroup)\n    } \n  }\n  return currentGroup\n}\n\nfunction getDirection(firstObjectID, secondObjectID){\n  // Get direction from the source object\n  const firstObject = document.getLayerWithID(firstObjectID)\n  const secondObject = document.getLayerWithID(secondObjectID)\n  const firstObjectMidX = firstObject.frame.x+firstObject.frame.width/2\n  const firstObjectMidY = firstObject.frame.y+firstObject.frame.height/2\n  const secondObjectMidX = secondObject.frame.x+secondObject.frame.width/2\n  const secondObjectMidY = secondObject.frame.y+secondObject.frame.height/2\n\n  const diffX = firstObjectMidX - secondObjectMidX\n  const diffY = firstObjectMidY - secondObjectMidY\n  const absDiffX = Math.abs(diffX) \n  const absDiffY = Math.abs(diffY)\n  let direction\n\n  if(secondObjectMidX > firstObjectMidX){\n    // Right Half\n    if(secondObjectMidY > firstObjectMidY){\n      // Bottom quarter\n      if(diffX > diffY) {\n        direction = \"Down\"\n      } else {\n        direction = \"Right\"\n      }\n    } else {\n      // Top quarter\n      if(absDiffX > absDiffY) {\n        direction = \"Right\"\n      } else {\n        direction = \"Up\"\n      }\n    }\n  } else {\n    // Left Half\n    if(secondObjectMidY > firstObjectMidY){\n      // Bottom quarter\n      if(absDiffX > absDiffY) {\n        direction = \"Left\"\n      } else {\n        direction = \"Down\"\n      }\n    } else {\n      // Top quarter\n      if(diffX > diffY) {\n        direction = \"Left\"\n      } else {\n        direction = \"Up\"\n      }\n    }\n  }\n  return direction\n}\n\nfunction drawLine(firstObjectID, secondObjectID, style, type, direction, currentGroup, condition){\n  let firstLayerPosX, firstLayerPosY, secondLayerPosX, secondLayerPosY, middlePosX, middlePosY, diffX, diffY\n  let line = []\n  let firstObject = document.getLayerWithID(firstObjectID)\n  let secondObject = document.getLayerWithID(secondObjectID)\n\n  let firstObjectAbsPos = firstObject.frame.changeBasis({from: firstObject.parent, to: currentParentGroup})\n  let secondObjectAbsPos = secondObject.frame.changeBasis({from: secondObject.parent, to: currentParentGroup})\n\n  if(currentGroup){\n    //if we already have a group, need to specify the difference\n    diffX = currentGroup.frame().x()\n    diffY = currentGroup.frame().y()\n  } else {\n    diffX = 0\n    diffY = 0\n  }\n\n  // Drawing a line\n  let path = NSBezierPath.bezierPath()\n\n  // Getting all the positions\n  if(direction == \"Up\"){\n    // First Layer Position Start Point Position\n    firstLayerPosX = firstObjectAbsPos.x+firstObjectAbsPos.width/2-diffX\n    firstLayerPosY = firstObjectAbsPos.y-diffY\n\n    // Second Layer Position End Point Position\n    secondLayerPosX = secondObjectAbsPos.x+secondObjectAbsPos.width/2-diffX\n    secondLayerPosY = secondObjectAbsPos.y+secondObjectAbsPos.height-diffY\n\n    // Middle Points\n    middlePosX = (firstLayerPosX + secondLayerPosX)/2\n    middlePosY = (firstLayerPosY + secondLayerPosY)/2\n  }\n\n  if(direction == \"Right\"){\n    // First Layer Position Start Point Position\n    firstLayerPosX = firstObjectAbsPos.x+firstObjectAbsPos.width-diffX\n    firstLayerPosY = firstObjectAbsPos.y+firstObjectAbsPos.height/2-diffY\n\n    // Second Layer Position End Point Position\n    secondLayerPosX = secondObjectAbsPos.x-diffX\n    secondLayerPosY = secondObjectAbsPos.y+secondObjectAbsPos.height/2-diffY\n    \n    // Middle Points\n    middlePosX = (firstLayerPosX + secondLayerPosX)/2\n    middlePosY = (firstLayerPosY + secondLayerPosY)/2\n  }\n\n  if(direction == \"Down\"){\n    // First Layer Position Start Point Position\n    firstLayerPosX = firstObjectAbsPos.x+firstObjectAbsPos.width/2-diffX\n    firstLayerPosY = firstObjectAbsPos.y+firstObjectAbsPos.height-diffY\n\n    // Second Layer Position End Point Position\n    secondLayerPosX = secondObjectAbsPos.x+secondObjectAbsPos.width/2-diffX\n    secondLayerPosY = secondObjectAbsPos.y-diffY\n\n    // Middle Points\n    middlePosX = (firstLayerPosX + secondLayerPosX)/2\n    middlePosY = (firstLayerPosY + secondLayerPosY)/2\n  }\n\n  if(direction == \"Left\"){\n    // First Layer Position Start Point Position\n    firstLayerPosX = firstObjectAbsPos.x-diffX\n    firstLayerPosY = firstObjectAbsPos.y+firstObjectAbsPos.height/2-diffY\n\n    // Second Layer Position End Point Position\n    secondLayerPosX = secondObjectAbsPos.x+secondObjectAbsPos.width-diffX\n    secondLayerPosY = secondObjectAbsPos.y+secondObjectAbsPos.height/2-diffY\n\n    // Middle Points\n    middlePosX = (firstLayerPosX + secondLayerPosX)/2\n    middlePosY = (firstLayerPosY + secondLayerPosY)/2\n  }\n\n  if(type == \"Angled\" || type == null){\n    // Based on direction, we need to specify connection points\n    \n    if(direction == \"Up\"){\n      // Connecting points\n      path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(firstLayerPosX,middlePosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,middlePosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n    }\n\n    if(direction == \"Right\"){\n      // Connecting points\n      path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(middlePosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(middlePosX,secondLayerPosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n    }\n\n    if(direction == \"Down\"){\n      // Connecting points\n      path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(firstLayerPosX,middlePosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,middlePosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n    }\n\n    if(direction == \"Left\"){\n      // Connecting points\n      path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(middlePosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(middlePosX,secondLayerPosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n    }\n\n    // Painting the line\n    line[0] = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n\n\n    // Making middle points rounded\n    let points = line[0].layers().firstObject().points()\n    points[1].cornerRadius = 20\n    points[2].cornerRadius = 20\n\n    // Providing Settings for the arrow\n    line[0].setName(\"Arrow\")\n  }\n\n  if(type == \"Straight\"){\n    // Based on direction, we need to specify connection points\n    if(direction == \"Up\"){\n      // Connecting points\n      path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n    }\n\n    if(direction == \"Right\"){\n      // Connecting points\n      path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n    }\n\n    if(direction == \"Down\"){\n      // Connecting points\n      path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n    }\n\n    if(direction == \"Left\"){\n      // Connecting points\n      path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n    }\n\n    // Painting the line\n    line[0] = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n      \n    // Providing Settings for the arrow\n    line[0].setName(\"Arrow\")\n  }\n\n  if(type == \"Curved\"){\n    if(direction == \"Up\"){\n      // Connecting points\n      path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n\n      // Painting the line\n      line[0] = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n      let points = line[0].layers().firstObject().points()\n\n      points[0].curveMode = points[1].curveMode = 4\n      points[0].hasCurveFrom = points[1].hasCurveTo = true\n\n      if(firstLayerPosX<secondLayerPosX){\n        points[0].curveFrom = {x: 0, y: 0.5}\n        points[0].curveTo = {x: -0.5,y:1}\n\n        points[1].curveFrom = {x: 1,y: 1}\n        points[1].curveTo = {x: 1,y: 0.5}\n      } else {\n        points[0].curveFrom = {x: 1, y: 0.5}\n        points[0].curveTo = {x: -0.5,y:1}\n\n        points[1].curveFrom = {x: 1,y: 1}\n        points[1].curveTo = {x: 0,y: 0.5}\n      }\n    }\n\n    if(direction == \"Right\"){\n      // Connecting points\n      path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n\n      // Painting the line\n      line[0] = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n      let points = line[0].layers().firstObject().points()\n\n      points[0].curveMode = points[1].curveMode = 4\n      points[0].hasCurveFrom = points[1].hasCurveTo = true\n\n      if(firstLayerPosY<secondLayerPosY){\n        points[0].curveFrom = {x: 0.5, y: 0}\n        points[0].curveTo = {x: -0.5,y:1}\n\n        points[1].curveFrom = {x: 1,y: 1}\n        points[1].curveTo = {x: 0.5,y: 1}\n      } else {\n        points[0].curveFrom = {x: 0.5, y: 1}\n        points[0].curveTo = {x: -0.5,y:1}\n\n        points[1].curveFrom = {x: 1,y: 1}\n        points[1].curveTo = {x: 0.5,y: 0}\n      }\n    }\n\n    if(direction == \"Down\"){\n      // Connecting points\n      path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n\n      // Painting the line\n      line[0] = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n      let points = line[0].layers().firstObject().points()\n\n      points[0].curveMode = points[1].curveMode = 4\n      points[0].hasCurveFrom = points[1].hasCurveTo = true\n\n      if(firstLayerPosX<secondLayerPosX){\n        points[0].curveFrom = {x: 0, y: 0.5}\n        points[0].curveTo = {x: -0.5,y:1}\n\n        points[1].curveFrom = {x: 1,y: 1}\n        points[1].curveTo = {x: 1,y: 0.5}\n      } else {\n        points[0].curveFrom = {x: 1, y: 0.5}\n        points[0].curveTo = {x: -0.5,y:1}\n\n        points[1].curveFrom = {x: 1,y: 1}\n        points[1].curveTo = {x: 0,y: 0.5}\n      }\n    }\n\n    if(direction == \"Left\"){\n      // Connecting points\n      path.moveToPoint(NSMakePoint(firstLayerPosX,firstLayerPosY))\n      path.lineToPoint(NSMakePoint(secondLayerPosX,secondLayerPosY))\n\n      // Painting the line\n      line[0] = MSShapeGroup.layerWithPath(MSPath.pathWithBezierPath(path))\n      let points = line[0].layers().firstObject().points()\n\n      points[0].curveMode = points[1].curveMode = 4\n      points[0].hasCurveFrom = points[1].hasCurveTo = true\n\n      if(firstLayerPosY<secondLayerPosY){\n        points[0].curveFrom = {x: 0.5, y: 0}\n        points[0].curveTo = {x: -0.5,y:1}\n\n        points[1].curveFrom = {x: 1,y: 1}\n        points[1].curveTo = {x: 0.5,y: 1}\n      } else {\n        points[0].curveFrom = {x: 0.5, y: 1}\n        points[0].curveTo = {x: -0.5,y:1}\n\n        points[1].curveFrom = {x: 1,y: 1}\n        points[1].curveTo = {x: 0.5,y: 0}\n      }\n    }\n\n    // Providing Settings for the arrow\n    line[0].setName(\"Arrows\")\n  }\n\n  if(condition != false){\n    line[1] = addCondition(\"Answer YES\", middlePosX, middlePosY)\n  }\n\n\n  if(style == null){\n    // that means we are creating new arrow\n    if(context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey)){\n\n      // if we have specified options\n      // TODO: Need to refactor here. Local Style is not used at all\n      let style = getLayerStyles(context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey))\n      if(style[0] == null){ \n        // Default Arrow Style\n        let border = line[0].style().addStylePartOfType(1)\n        border.color = MSColor.colorWithRGBADictionary({r: 0.89, g: 0.89, b: 0.89, a: 1})\n        border.thickness = 2\n        line[0].style().endMarkerType = 2\n      } else {\n        line[0].sharedStyle = style[0]\n      }\n    } else {\n      // Default Arrow Style\n      let border = line[0].style().addStylePartOfType(1)\n      border.color = MSColor.colorWithRGBADictionary({r: 0.89, g: 0.89, b: 0.89, a: 1})\n      border.thickness = 2\n      line[0].style().endMarkerType = 2\n    }\n  } else {\n    // arrow style already provided\n    if(style == \"Default Style\"){\n      // Default Arrow Style\n      let border = line[0].style().addStylePartOfType(1)\n      border.color = MSColor.colorWithRGBADictionary({r: 0.89, g: 0.89, b: 0.89, a: 1})\n      border.thickness = 2\n      line[0].style().endMarkerType = 2\n    } else {\n      // User provided own style\n      let ownStyle = getLayerStyles(style)\n      line[0].sharedStyle = ownStyle[0]\n    }\n  }\n\n  return line\n}\n\nfunction addToArrowsGroup(line, currentGroup){\n  if(currentGroup){\n    currentGroup.addLayers([line])\n    currentGroup.fixGeometryWithOptions(1)\n  } else {\n    // If we don't have a group\n    let Group = require('sketch/dom').Group\n    let group = new Group({\n      parent: currentParentGroup,\n      name: 'Arrows',\n      locked: true,\n      layers: [line]\n    })\n    // Moving this group to the bottom of the page\n    group.moveToBack()\n    currentGroup = checkForGroup(\"Arrows\")\n    currentGroup.fixGeometryWithOptions(1)\n  }\n\n  \n  \n}\n\nfunction getConnectionsData(){\n  let dataArray = []\n  let pluginDataConnections = []\n  if(pluginData){\n    pluginDataConnections = context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowConnections\", docData, pluginKey)\n    \n    for (let i = 0; i < pluginDataConnections.length; i ++) {\n      dataArray.push(pluginDataConnections[i])\n    }\n  } \n  return dataArray\n}\n\nfunction findConnectionData(firstObjectID, secondObjectID, data){\n  let arrayNumber = null\n  firstObjectID = String(firstObjectID)\n  secondObjectID = String(secondObjectID)\n\n  if(pluginData){\n    // If we have database, need to check for connections\n\n    for(let y = 0; y < data.length; y++){\n\n      if(firstObjectID == data[y].firstObject || firstObjectID == data[y].secondObject){\n        // if we found that we have this object in connection database already\n        if(secondObjectID == data[y].firstObject || secondObjectID == data[y].secondObject){\n          // if we found that we have this object in connection database already\n          arrayNumber = y\n        } \n      }\n    }\n  }\n  return arrayNumber\n}\n\nfunction setActiveDirectionSetting(arrowDirectionField){\n  let currentDirection = \"Auto\"\n\n  if(Settings.settingForKey(\"arrowDirection\")){\n    // if there is data in settings\n    currentDirection = Settings.settingForKey(\"arrowDirection\")  \n    \n    if(currentDirection == \"Auto\"){\n      arrowDirectionField.addItemWithTitle(\"Auto\")\n      arrowDirectionField.lastItem().setState(1)\n      arrowDirectionField.addItemWithTitle(\"Right\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Down\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Left\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Up\")\n      arrowDirectionField.lastItem().setState(0)\n    } \n    \n    if(currentDirection == \"Right\"){\n      arrowDirectionField.addItemWithTitle(\"Right\")\n      arrowDirectionField.lastItem().setState(1)\n      arrowDirectionField.addItemWithTitle(\"Down\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Left\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Up\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Auto\")\n      arrowDirectionField.lastItem().setState(0)\n    } \n\n    if(currentDirection == \"Down\"){\n      arrowDirectionField.addItemWithTitle(\"Down\")\n      arrowDirectionField.lastItem().setState(1)\n      arrowDirectionField.addItemWithTitle(\"Left\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Up\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Auto\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Right\")\n      arrowDirectionField.lastItem().setState(0)\n    } \n\n    if(currentDirection == \"Left\"){\n      arrowDirectionField.addItemWithTitle(\"Left\")\n      arrowDirectionField.lastItem().setState(1)\n      arrowDirectionField.addItemWithTitle(\"Up\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Auto\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Right\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Down\")\n      arrowDirectionField.lastItem().setState(0)\n    } \n\n    if(currentDirection == \"Up\"){\n      arrowDirectionField.addItemWithTitle(\"Up\")\n      arrowDirectionField.lastItem().setState(1)\n      arrowDirectionField.addItemWithTitle(\"Auto\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Right\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Down\")\n      arrowDirectionField.lastItem().setState(0)\n      arrowDirectionField.addItemWithTitle(\"Left\")\n      arrowDirectionField.lastItem().setState(0)\n    } \n\n  } else {\n    // Show default\n    arrowDirectionField.addItemWithTitle(\"Auto\")\n    arrowDirectionField.addItemWithTitle(\"Right\")\n    arrowDirectionField.addItemWithTitle(\"Down\")\n    arrowDirectionField.addItemWithTitle(\"Left\")\n    arrowDirectionField.addItemWithTitle(\"Up\")\n  }\n}\n\nfunction setActiveStyleSetting(arrowStylingField){\n  let docSettings = context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowStyle\", docData, pluginKey)\n  let styles = getLayerStyles(null)\n\n  if(docSettings){\n    // We have info about the settings in the current document\n    \n    if(docSettings != \"Default Style\") {\n      // if user specified own option\n      arrowStylingField.addItemWithTitle(docSettings)\n      arrowStylingField.addItemWithTitle(\"Default Style\")\n      for(let i = 0; i < styles.length; i++){\n        if(styles[i].name() != docSettings){\n          arrowStylingField.addItemWithTitle(styles[i].name())\n        }\n      }\n\n    } else {\n      // Need to show the default first\n      arrowStylingField.addItemWithTitle(\"Default Style\")\n      for(let i = 0; i < styles.length; i++){\n        arrowStylingField.addItemWithTitle(styles[i].name())\n      }\n    }\n  } else {\n    arrowStylingField.addItemWithTitle(\"Default Style\")\n    for(let i = 0; i < styles.length; i++){\n      arrowStylingField.addItemWithTitle(styles[i].name())\n    }\n  }\n}\n\nfunction setActiveTypeSetting(arrowTypeField){\n  let docTypeSettings = Settings.settingForKey(\"arrowType\")  \n\n\n  if(docTypeSettings){\n    // We have info about the settings in the current document\n    \n    if(docTypeSettings == \"Angled\"){\n      arrowTypeField.addItemWithTitle(\"Angled\")\n      arrowTypeField.lastItem().setState(1)\n      arrowTypeField.addItemWithTitle(\"Curved\")\n      arrowTypeField.lastItem().setState(0)\n      arrowTypeField.addItemWithTitle(\"Straight\")\n      arrowTypeField.lastItem().setState(0)\n    } \n\n    if(docTypeSettings == \"Curved\"){\n      arrowTypeField.addItemWithTitle(\"Curved\")\n      arrowTypeField.lastItem().setState(1)\n      arrowTypeField.addItemWithTitle(\"Straight\")\n      arrowTypeField.lastItem().setState(0)\n      arrowTypeField.addItemWithTitle(\"Angled\")\n      arrowTypeField.lastItem().setState(0)\n    } \n\n    if(docTypeSettings == \"Straight\"){\n      arrowTypeField.addItemWithTitle(\"Straight\")\n      arrowTypeField.lastItem().setState(1)\n      arrowTypeField.addItemWithTitle(\"Angled\")\n      arrowTypeField.lastItem().setState(0)\n      arrowTypeField.addItemWithTitle(\"Curved\")\n      arrowTypeField.lastItem().setState(0)\n    } \n  } else {\n    // Show default\n    arrowTypeField.addItemWithTitle(\"Angled\")\n    arrowTypeField.addItemWithTitle(\"Curved\")\n    arrowTypeField.addItemWithTitle(\"Straight\")\n  }\n\n}\n\nfunction deleteConnectionFromData(arrayNumber){\n  let newConnections = []\n  if(pluginData){\n    // If we have database\n    let connections = context.command.valueForKey_onLayer_forPluginIdentifier(\"arrowConnections\", docData, pluginKey)\n\n    for (let i = 0; i < connections.length; i ++) {\n      // Updating all connections without deleted one\n      if(i != arrayNumber){\n        newConnections.push(connections[i])\n      }\n    }\n  }\n  return newConnections\n}\n\nfunction refactorLines(group){ // Need to finish\n  for(let i = 0; i < group.layers().length; i++){\n    // Here we need to go through each data in our database and delete line if there is no data\n  }\n}\n\nfunction deleteLine(lineID){\n  const lineObject = document.getLayerWithID(lineID)\n  let selectedGroup\n  if(lineObject){\n    selectedGroup = lineObject.parent\n    lineObject.remove()\n    if(selectedGroup.layers.length == 0){\n      selectedGroup.remove()\n    }\n  }\n}\n\nfunction updateSpacing(sourceObjectID, childObjectID, direction){\n  let sourceObject = document.getLayerWithID(sourceObjectID)\n  let childObject = document.getLayerWithID(childObjectID)\n\n  if(Settings.settingForKey(\"arrowSpacing\") && Settings.settingForKey(\"arrowSpacing\") != 0){\n    let currentSpacing = Settings.settingForKey(\"arrowSpacing\")\n    \n    if(direction == \"Right\"){\n      childObject.frame.x = sourceObject.frame.x + sourceObject.frame.width + currentSpacing\n    }\n  \n    if(direction == \"Down\"){\n      childObject.frame.y = sourceObject.frame.y + sourceObject.frame.height + currentSpacing\n    }\n  \n    if(direction == \"Left\"){\n      childObject.frame.x = sourceObject.frame.x - childObject.frame.width - currentSpacing\n    }\n  \n    if(direction == \"Up\"){\n      childObject.frame.y = sourceObject.frame.y - childObject.frame.height - currentSpacing\n    }\n  }\n}\n\nfunction autoAlignLayer(sourceObjectID, childObjectID, direction){\n  let sourceObject = document.getLayerWithID(sourceObjectID)\n  let childObject = document.getLayerWithID(childObjectID)\n  let sourceMidY, childMidY, sourceMidX, childMidX, diff\n\n  if(Settings.settingForKey(\"autoAlign\")){\n    if(Settings.settingForKey(\"autoAlign\") == true){\n      // If user turned on Auto-Align settings\n      \n      if(direction == \"Right\" || direction == \"Left\"){\n        sourceMidY = sourceObject.frame.y + sourceObject.frame.height/2\n        childMidY = childObject.frame.y + childObject.frame.height/2\n        diff = sourceMidY - childMidY\n        if(diff > -6 && diff < 6){childObject.frame.y = childObject.frame.y + diff}\n      }\n    \n      if(direction == \"Down\" || direction == \"Up\"){\n        sourceMidX = sourceObject.frame.x + sourceObject.frame.width/2\n        childMidX = childObject.frame.x + childObject.frame.width/2\n        diff = sourceMidX - childMidX\n        if(diff > -6 && diff < 6){childObject.frame.x = childObject.frame.x + diff}\n      }\n    }\n  }\n}\n\nfunction defineSourceObject(firstObjectID, secondObjectID, direction){\n  let firstObject = document.getLayerWithID(firstObjectID)\n  let secondObject = document.getLayerWithID(secondObjectID)\n  let sourceObjectID\n\n  if(direction == \"Auto\"){\n    sourceObjectID = firstObject.id\n  }\n\n  if(direction == \"Right\"){\n    if(firstObject.frame.x <= secondObject.frame.x){\n      sourceObjectID = firstObject.id\n    } else {\n      sourceObjectID = secondObject.id\n    }\n  }\n\n  if(direction == \"Down\"){\n    if(firstObject.frame.y <= secondObject.frame.y){\n      sourceObjectID = firstObject.id\n    } else {\n      sourceObjectID = secondObject.id\n    }\n  }\n\n  if(direction == \"Left\"){\n    if(firstObject.frame.x <= secondObject.frame.x){\n      sourceObjectID = secondObject.id\n    } else {\n      sourceObjectID = firstObject.id\n    }\n  }\n\n  if(direction == \"Up\"){\n    if(firstObject.frame.y <= secondObject.frame.y){\n      sourceObjectID = secondObject.id\n    } else {\n      sourceObjectID = firstObject.id\n    }\n  }\n\n  return sourceObjectID\n}\n\nfunction getSourceObjectFromSelection(selection, direction){\n  let sourceObjectID = selection.firstObject().objectID()\n  \n  if(direction != \"Auto\"){\n    for(let g = 0; g < selection.count(); g++) {\n      sourceObjectID = defineSourceObject(sourceObjectID, selection[g].objectID(), direction)\n    }\n  } else {\n    sourceObjectID = defineSourceObject(sourceObjectID, selection[0].objectID(), direction)\n  }\n \n  return sourceObjectID\n}\n\nfunction confirmationAlert(alert, message) {\n    // Title\n    alert.setMessageText(\"Would you like to delete all the arrows from \"+message)\n\n    // Creating dialog buttons\n    alert.addButtonWithTitle(\"Delete Arrows\")\n    alert.addButtonWithTitle(\"Cancel\")\n  \n    // Creating the view\n    const viewWidth = 300\n    const viewHeight = 40\n  \n    let view = NSView.alloc().initWithFrame(NSMakeRect(0, 0, viewWidth, viewHeight))\n    alert.addAccessoryView(view)\n  \n    // Label\n    var infoLabel = NSTextField.alloc().initWithFrame(NSMakeRect(-1, viewHeight - 40, 330, 40))\n  \n    infoLabel.setStringValue(\" You can select layers, artboards to delete all the arrows from selected one only\")\n    infoLabel.setSelectable(false)\n    infoLabel.setDrawsBackground(false)\n    infoLabel.setBezeled(false)\n  \n    view.addSubview(infoLabel)\n\n    return alert\n}\n\nfunction alertSetup(alert, viewWidth, viewHeight){\n  // Title\n  alert.setMessageText(\"Arrow Plugin Settings\")\n  \n  // Creating dialog buttons\n  alert.addButtonWithTitle(\"Update Settings\")\n  alert.addButtonWithTitle(\"Cancel\")\n  \n  return alert\n}\n\nfunction alertLabel(message, state, x, y, width, height){\n  let infoLabel = NSTextField.alloc().initWithFrame(NSMakeRect(x, y, width, height))\n\n  infoLabel.setStringValue(message)\n  infoLabel.setSelectable(false)\n  infoLabel.setDrawsBackground(false)\n  infoLabel.setBezeled(false)\n\n  if(state == false){\n    infoLabel.textColor = NSColor.disabledControlTextColor()\n  }\n\n  return infoLabel\n}\n\nfunction alertCheckbox(message, state, x, y, width, height){\n  let checkbox = NSButton.alloc().initWithFrame(NSMakeRect(x, y, width, height))\n\n  checkbox.setButtonType(NSSwitchButton)\n  checkbox.setBezelStyle(0)\n  checkbox.setTitle(message)\n  if(Settings.settingForKey(\"autoAlign\")){\n    let currentState = Settings.settingForKey(\"autoAlign\")  \n    checkbox.setState(currentState)\n  } else {\n    checkbox.setState(state)\n  }\n\n  return checkbox\n}\n\nfunction getLayerStyles(name) {\n  let allStyles = docData.allLayerStyles()\n  let keyword = \"$arrow\"\n  let styles = []\n  if(name == null) {\n    for(let i = 0; i < allStyles.count(); i++){\n      if(allStyles[i].name().includes(keyword)){\n        styles.push(allStyles[i]);\n      }\n    }\n  } else {\n    // Searching only for name\n    for(let i = 0; i < allStyles.count(); i++){\n      if(allStyles[i].name() == name){\n        styles.push(allStyles[i]);\n      }\n    }\n  }\n\treturn styles\n}\n\nfunction start(context, direction, condition){\n  let selection = context.selection\n  let localDirection\n  if(direction == null){localDirection = arrowDirectionSetting} else {localDirection = direction}\n\n  if(selection.count() > 1){\n    // Need to find source object by ID first\n    let sourceObjectID = getSourceObjectFromSelection(selection, direction)\n    let currentConnectionsData = newConnectionsData\n\n    for(let g = 0; g < selection.count(); g++) {\n      if(selection[g].objectID() != sourceObjectID){\n        // Then need to create or update connection arrow with each selection\n        let connectionIndex = findConnectionData(sourceObjectID, selection[g].objectID(), currentConnectionsData)\n        if(connectionIndex != null){\n          // Because this is creating flow, we need to take the direction from user settings\n          if(condition == true){\n            // Need to remake the arrow condition\n            if(currentConnectionsData[connectionIndex].condition){\n              updateArrow(sourceObjectID, selection[g].objectID(), null, null, localDirection, currentConnectionsData[connectionIndex].line, currentConnectionsData[connectionIndex].condition, connectionIndex)\n            } else {\n              updateArrow(sourceObjectID, selection[g].objectID(), null, null, localDirection, currentConnectionsData[connectionIndex].line, true, connectionIndex)\n            }\n          } else {\n            updateArrow(sourceObjectID, selection[g].objectID(), null, null, localDirection, currentConnectionsData[connectionIndex].line, currentConnectionsData[connectionIndex].condition, connectionIndex)\n          }\n          sketch.UI.message(\"Current connection is updated \")\n        } else {\n          // There is no connection with this two objects in our database\n          if(condition == true){\n            createArrow(sourceObjectID, selection[g].objectID(), null, null, localDirection, true)\n          } else {\n            createArrow(sourceObjectID, selection[g].objectID(), null, null, localDirection, false)\n          }\n          sketch.UI.message(\"New connection is created \")\n        }\n      }\n    }\n    context.command.setValue_forKey_onLayer_forPluginIdentifier(newConnectionsData, \"arrowConnections\", docData, pluginKey)\n  } else {\n    // When user didn't select anything\n    sketch.UI.message(\"Please select more than two layers\")\n  }\n}\n\n// {\n//   \"script\": \"./script.js\",\n//   \"name\" : \"onLayersMoved\",\n//   \"handlers\" : {\n//     \"actions\": {\n//       \"LayersMoved.finish\": \"onLayersMoved\"\n//     }\n//   },\n//   \"identifier\" : \"onLayersMoved\"\n// }\n\nfunction getConditionID(keyword){\n  let libraries = sketch.getLibraries()\n  let conditionID, symbolReferences\n  // let keyword = \"#condition\"\n\n  // log(libraries.length)\n\n  for(let g = 0; g < libraries.length; g++) {\n    symbolReferences = libraries[g].getImportableSymbolReferencesForDocument(document)\n\n    for(let i = 0; i < symbolReferences.length; i++) {\n      if(symbolReferences[i].name.includes(keyword)){\n        conditionID = symbolReferences[i].id \n      }\n    }\n  }\n\n  if(conditionID == null){\n    UI.alert('Condition symbol is not found', 'If you would like to add arrows with specific conditions, you need to specify them in your libraries. You can download the library that works well with the plugin by going into Plugins -> Connection Arrows -> Get Free Library. Conditions are taken from the library based on their names. Make sure to name symbol as \"#condition\" so it will be added here')\n  }\n\n  // symbolReferences = libraries[g].getImportableSymbolReferencesForDocument(document)\n\n  // log(symbolReferences)\n  // var symbolMaster = symbolReferences[0].import()\n\n\n  // var instance = symbolMaster.createNewInstance()\n  // console.log(instance)\n\n\n  // instance.parent = currentParentGroup\n  // log(symbolMaster)\n\n  return conditionID\n}\n\nfunction addCondition(keyword, x, y){\n  let libraries = sketch.getLibraries()\n  let conditionObject, symbolReferences\n\n  for(let g = 0; g < libraries.length; g++) {\n    symbolReferences = libraries[g].getImportableSymbolReferencesForDocument(document)\n\n    for(let i = 0; i < symbolReferences.length; i++) {\n      if(symbolReferences[i].name.includes(keyword)){\n        conditionObject = symbolReferences[i]\n      }\n    }\n  }\n\n  if(conditionObject == null){\n    UI.alert('Condition symbol is not found', 'If you would like to add arrows with specific conditions, you need to specify them in your libraries. You can download the library that works well with the plugin by going into Plugins -> Connection Arrows -> Get Free Library. Conditions are taken from the library based on their names. Make sure to name symbol as \"#condition\" so it will be added here')\n  } else {\n    let symbolMaster = conditionObject.import()\n    let instance = symbolMaster.createNewInstance()\n    instance.parent = currentParentGroup\n    instance.frame.x = x - instance.frame.width / 2 \n    instance.frame.y = y - instance.frame.height / 2\n  }\n\n  return conditionObject\n}\n\n\n\n\n\n\n","module.exports = require(\"sketch\");","module.exports = require(\"sketch/dom\");","module.exports = require(\"sketch/settings\");","module.exports = require(\"sketch/ui\");"],"sourceRoot":""}